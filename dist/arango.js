/*Copyright (c) Kaerus 2012 (kaerus.com), Anders Elo <anders @ kaerus com>*/
define("utils",["require"],function(e){function t(){var e=!1,n={},r=0;typeof arguments[r]=="boolean"&&(e=arguments[r++]),typeof arguments[r+1]=="object"&&(n=arguments[r++]);for(var i;i=arguments[r];r++)n=Object.keys(i).reduce(function(n,r){return e&&typeof i[r]=="object"?n[r]=t(!0,n[r],i[r]):n[r]=i[r],n},n);return n}function n(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}function r(e){if(!(this instanceof r))return new r;this._events={}}return r.prototype.on=function(e,t){return e in this._events||(this._events[e]=[]),this._events[e].indexOf(t)<0&&this._events[e].push(t),this},r.prototype.off=function(e,t){if(!this._events[e])return this;var n=this._events[e].indexOf(t);return n>=0&&(this._events[e].splice(n,1),this._events[e].length===0&&delete this._events[e]),this},r.prototype.emit=function(e){if(!this._events[e])return!1;var t=Array.prototype.slice.call(arguments,1),n,r=[],i=!1;for(var s=0,o=this._events[e].length;s<o;s++){n=this._events[e][s];if(typeof n=="function"){if(n.apply(this,t)===!1){i=!0;break}}else{if(typeof n!="object")throw"No valid event handler found";typeof n.after=="function"&&r.push(n.after)}}return r.forEach(function(e){i||e.apply(this,t)===!1&&(i=!0)}),this},r.prototype.once=function(e,t){var n=this;return this.on(e,function r(){n.off(e,r),t.apply(this,arguments)}),this},r.prototype.after=function(e,t){return e in this._events||(this._events[e]=[]),this._events[e].indexOf({after:t})<0&&this._events[e].push({after:t}),this},{extend:t,inherit:n,Emitter:r}}),define("query",["require","./utils"],function(e){var t=e("./utils");return function(e){function n(){function r(n){var i=n||t.struct;return e.filter(function(e){return i[e]?!0:!1}).map(function(e){var t=e.toUpperCase(),n=i[e];switch(t){case"FROM":t="IN";break;case"INCLUDE":t="";break;default:}if(typeof n=="object"){var s=r(n);return e==="in"?t+" ( "+s+" )":t+" "+s}return t+" "+n}).join(" ")}var e=["for","in","filter","from","include","collect","into","sort","limit","return"],t=this;e.forEach(function(e){t[e]=function(){t.struct||(t.struct={});if(!arguments.length)return t.struct[e];var r=Array.prototype.slice.call(arguments);return typeof r[0]=="function"?t.struct[e]=function(e){var t=new n;return e.apply(t),t.struct}(r[0]):t.struct[e]=r.join(" "),t}}),t.toString=r}function r(){function i(n,i){var s,o=0,u=Array.prototype.slice.call(i);return r.string?s=t.extend({query:r.string},r.options):typeof u[o]=="string"?s=t.extend({query:u[o++]},r.options):typeof u[o]=="object"&&u[o].struct?s=t.extend({query:u[o++].struct.toString()},r.options):s=t.extend({query:u[o++].toString()},r.options),typeof u[o]=="object"&&t.extend(s,{bindVars:u[o++]}),e.cursor[n](s,u[o])}var r=this;n.call(this),r.string={},r.new=function(){return new n},Object.defineProperty(this,"string",{get:function(){return r.struct?r.toString():this._string},set:function(e){this._string=e,r.struct=null}}),r.options={},r.count=function(e){return r.options.count=e>0?!0:!1,r.options.batchSize=e>0?e:undefined,r},r.test=function(){return i("query",arguments)},r.explain=function(){return i("explain",arguments)},r.exec=function(){var t=function(n){this.next=function(r){return n.id?e.cursor.get(n.id,r).on("result",t):!1}};return i("create",arguments).on("result",t)}}return t.inherit(r,n),new r}}),define("ajax",["require","./utils"],function(e){function r(e,t){var n={NOXHR:[1e3,"Ajax is not supported"],REQUEST:[1001,"Request operation failed"],UNIMPLEMENTED:[1002,"no such feature"]};return{name:"Ajax",type:e,code:n[e][0],message:n[e][1]+(t?": "+t:"")}}function c(e,t){n.Emitter.call(this),this.data=[],this.data.size=0,this.on("response",t),this.after("end",function(){e.close()}),this.after("error",function(){e.close()})}function h(t,l){if(i==="nodejs"){var p=e(t.protocol||"http").request;return h=function(e,t){return delete e.protocol,e.timeout&&(p.socket.setTimeout(e.timeout),delete e.timeout),p(e,t)},h(t,l)}if(!(this instanceof h))return new h(t,l);var d=this;d._send=[],d.xhr=new i,n.Emitter.call(this),t.timeout?(d._timeout=t.timeout,delete t.timeout):d._timeout=5e3,d.timeoutHandler=function(){d.xhr.abort()},d.response=new c(d,l),d.response.emit("response",d.response),d.xhr.onreadystatechange=function(){switch(d.xhr.readyState){case f:d.response.statusCode=d.xhr.status,d.response.headers||(d.response.headers=d.parseHeaders()),d.response.writeChunk(d.xhr.responseText),d.xhr.status?d.response.emit("end"):d.response.emit("error",r("REQUEST",d.xhr.statusText));break;case a:d.response.headers=d.parseHeaders(),d.response.writeChunk(d.xhr.responseText);break;case u:d.emit("ready");break;case o:break;case s:}},d.on("open",d.startTimer),d.on("close",d.clearTimer),d.request(t,l)}var t=typeof window=="object",n=e("./utils"),i=t?function(){var e,t;if(typeof window.XMLHttpRequest!="undefined")return window.XMLHttpRequest;if(typeof window.ActiveXObject!="undefined"){e="ActiveXObject";var n=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];for(var i=0,s=n.length;i<s;i++)try{return new window.ActiveXObject(n[i]),window.ActiveXObject(n[i])}catch(o){}throw r("NOXHR","XHR ActiveXObject failed")}throw r("NOXHR","XHR support not found")}():"nodejs",s=0,o=1,u=2,a=3,f=4,l=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];return n.inherit(c,n.Emitter),c.prototype.write=function(e){this.data.push(e),this.data.size+=e.length,this.emit("data",this.data[this.data.length-1])},c.prototype.writeChunk=function(e){e.length>this.data.size&&this.write(e.slice(this.data.size))},n.inherit(h,n.Emitter),h.prototype.write=function(e){return this._send.push(e),this},h.prototype.end=function(e){e&&this._send.push(e),this.xhr.send(this._send.length>0?this._send.join():null)},h.prototype.close=function(){this.emit("close")},h.prototype.parseHeaders=function(){var e={},t,n,r,i=this.xhr.getAllResponseHeaders();return i.split("\n").forEach(function(i){r=i.indexOf(":"),t=i.slice(0,r).replace(/^[\s]+|[\s]+$/g,"").toLowerCase(),n=i.slice(r+1,i.length).replace(/^[\s]+|[\s]+$/g,""),t&&t.length&&(e[t]=n)}),e},h.prototype.request=function(e,n){var r=e.protocol==="file"&&t,i=r?"http://127.0.0.1:8529"+e.path:e.protocol+"://"+e.hostname+":"+e.port+e.path;e.method=e.method||"GET",e.headers||(e.headers={}),e.headers["content-type"]||(e.headers["content-type"]="application/json"),console.log("Ajax Request %s %s",e.method,i),this.xhr.open(e.method,i,!0),this.emit("open",e.method,i),Object.keys(e.headers).forEach(function(n){n=n.toLowerCase(),(!t||l.indexOf(n)<0)&&this.xhr.setRequestHeader(n,e.headers[n])},this)},h.prototype.startTimer=function(){this.timer=setTimeout(this.timeoutHandler,this._timeout)},h.prototype.clearTimer=function(){clearTimeout(this.timer)},h.prototype.resetTimer=function(){clearTimeout(this.timer),this.startTimer()},{request:h}}),define("request",["require","./utils","./ajax"],function(e){var t=e("./utils"),n=e("./ajax");return function(e){function r(r,i,s,o){function h(e,t,n){a.error={code:t,message:n},o?o(e&&t,e?n:a.result||a.data,a.headers):e?a.emit("error",a.error):a.emit("result",a.result||a.data,a.headers)}t.Emitter.call(this);try{s=s&&!s.length?new Buffer(JSON.stringify(s)):s}catch(u){s=JSON.stringify(s)}var a=this,f=[],l=t.extend(!0,{path:i,headers:{"content-type":"application/json",connection:"keep-alive","content-length":s?s.length:0}},r,e.config.server),c=n.request(l,function(e){typeof e.data!="object"&&(e.data=[],e.on("data",function(t){e.data.push(t)})),e.on("end",function(){a.headers=e.headers;if(e.data.length>0)try{a.result=JSON.parse(e.data.join(""))}catch(t){a.data=e.data}a.result?h(a.result.error,e.statusCode,a.result.errorMessage):(e.error===undefined&&(e.error=!0),h(e.error,e.statusCode,e.message))})}).on("error",function(e){h(!0,e.code,e.message)});s&&c.write(s),c.end()}return t.inherit(r,t.Emitter),{post:function(e,t,n){return new r({method:"POST"},e,t,n)},get:function(e,t){return new r({method:"GET"},e,null,t)},put:function(e,t,n){return new r({method:"PUT"},e,t,n)},"delete":function(e,t){return new r({method:"DELETE"},e,null,t)},patch:function(e,t,n){return new r({method:"PATCH"},e,t,n)},head:function(e,t){return new r({method:"HEAD"},e,null,t)},raw:function(e,t,n,i){return new r(e,t,n,i)}}}}),define("ext/sha256",["require"],function(e){var t=t||function(e,t){var n={},r=n.lib={},i=r.Base=function(){function e(){}return{extend:function(t){e.prototype=this;var n=new e;return t&&n.mixIn(t),n.$super=this,n},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.$super.extend(this)}}}(),s=r.WordArray=i.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,e=e.sigBytes;this.clamp();if(r%4)for(var i=0;i<e;i++)t[r+i>>>2]|=(n[i>>>2]>>>24-8*(i%4)&255)<<24-8*((r+i)%4);else if(65535<n.length)for(i=0;i<e;i+=4)t[r+i>>>2]=n[i>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-8*(n%4),t.length=e.ceil(n/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return s.create(n,t)}}),o=n.enc={},u=o.Hex={stringify:function(e){for(var t=e.words,e=e.sigBytes,n=[],r=0;r<e;r++){var i=t[r>>>2]>>>24-8*(r%4)&255;n.push((i>>>4).toString(16)),n.push((i&15).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-4*(r%8);return s.create(n,t/2)}},a=o.Latin1={stringify:function(e){for(var t=e.words,e=e.sigBytes,n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-8*(r%4)&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(e.charCodeAt(r)&255)<<24-8*(r%4);return s.create(n,t)}},f=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(a.stringify(e)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(e){return a.parse(unescape(encodeURIComponent(e)))}},l=r.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=s.create(),this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=f.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,o=this.blockSize,u=i/(4*o),u=t?e.ceil(u):e.max((u|0)-this._minBufferSize,0),t=u*o,i=e.min(4*t,i);if(t){for(var a=0;a<t;a+=o)this._doProcessBlock(r,a);a=r.splice(0,t),n.sigBytes-=i}return s.create(a,i)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=l.extend({init:function(){this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize(),this._hash},clone:function(){var e=l.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:16,_createHelper:function(e){return function(t,n){return e.create(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return c.HMAC.create(e,n).finalize(t)}}});var c=n.algo={};return n}(Math);return function(e){var n=t,r=n.lib,i=r.WordArray,r=r.Hasher,s=n.algo,o=[],u=[];(function(){function t(t){for(var n=e.sqrt(t),r=2;r<=n;r++)if(!(t%r))return!1;return!0}function n(e){return 4294967296*(e-(e|0))|0}for(var r=2,i=0;64>i;)t(r)&&(8>i&&(o[i]=n(e.pow(r,.5))),u[i]=n(e.pow(r,1/3)),i++),r++})();var a=[],s=s.SHA256=r.extend({_doReset:function(){this._hash=i.create(o.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],s=n[2],o=n[3],f=n[4],l=n[5],c=n[6],h=n[7],p=0;64>p;p++){if(16>p)a[p]=e[t+p]|0;else{var d=a[p-15],v=a[p-2];a[p]=((d<<25|d>>>7)^(d<<14|d>>>18)^d>>>3)+a[p-7]+((v<<15|v>>>17)^(v<<13|v>>>19)^v>>>10)+a[p-16]}d=h+((f<<26|f>>>6)^(f<<21|f>>>11)^(f<<7|f>>>25))+(f&l^~f&c)+u[p]+a[p],v=((r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22))+(r&i^r&s^i&s),h=c,c=l,l=f,f=o+d|0,o=s,s=i,i=r,r=d+v|0}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+s|0,n[3]=n[3]+o|0,n[4]=n[4]+f|0,n[5]=n[5]+l|0,n[6]=n[6]+c|0,n[7]=n[7]+h|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;t[r>>>5]|=128<<24-r%32,t[(r+64>>>9<<4)+15]=n,e.sigBytes=4*t.length,this._process()}});n.SHA256=r._createHelper(s),n.HmacSHA256=r._createHmacHelper(s)}(Math),t}),define("api/cursor",["require"],function(e){return function(e){var t="/_api/cursor/";return{get:function(n,r){return e.put(t+n,{},r)},create:function(n,r){return e.post(t,n,r)},query:function(t,n){return e.post("/_api/query",t,n)},explain:function(t,n){return e.post("/_api/explain",t,n)},"delete":function(n,r){return e.delete(t+n,r)}}}}),define("api/collection",["require"],function(e){return function(e){var t="/_api/collection/";return{create:function(){var n=e.config.name,r={},i,s=0;return typeof arguments[s]=="string"&&(n=arguments[s++]),typeof arguments[s]=="object"&&(r=arguments[s++]),typeof arguments[s]=="function"&&(i=arguments[s++]),r.name||(r.name=n),console.log("Create collection(%s): ",n,r),e.post(t,r,i)},get:function(n,r){return e.get(t+n,r)},"delete":function(n,r){return e.delete(t+n,r)},truncate:function(n,r){return e.put(t+n+"/truncate",null,r)},count:function(n,r){return e.get(t+n+"/count",r)},figures:function(n,r){return e.get(t+n+"/figures",r)},list:function(n){return e.get(t,n)},load:function(n,r){return e.put(t+n+"/load",null,r)},unload:function(n,r){return e.put(t+n+"/unload",null,r)},rename:function(n,r,i){return typeof r=="string"&&(r={name:r}),e.put(t+n+"/rename",r,i)},getProperties:function(n,r){return e.get(t+n+"/properties",r)},setProperties:function(n,r,i){return e.put(t+n+"/properties",r,i)}}}}),define("api/document",["require"],function(e){return function(e){function r(t,n,r,i){var s={};return s[t]=JSON.stringify(r),e.raw({headers:s},n,null,i)}function i(t,n,r,i,s){var o={};return o[t]=JSON.stringify(r),e.raw({method:"PUT",headers:o},n,i,s)}var t="/_api/document/",n="/_api/document?collection=";return{create:function(){var t=e.config.name,r={},i="",s,o=0;return typeof arguments[o]=="boolean"&&(i="&createCollection=true",o++),typeof arguments[o]=="string"&&(t=arguments[o++]),typeof arguments[o]=="object"&&(r=arguments[o++]),typeof arguments[o]=="function"&&(s=arguments[o++]),e.post(n+t+i,r,s)},get:function(n,r){return e.get(t+n,r)},getIfNoneMatch:function(e,n,i){return r("If-None-Match",t+e,n,i)},getIfMatch:function(e,n,i){return r("If-Match",t+e,n,i)},put:function(n,r,i){return e.put(t+n,r,i)},putIfNoneMatch:function(e,n,r,s){return i("if-none-match",t+e,n,r,s)},putIfMatch:function(e,n,r,s){return i("if-match",t+e,n,r,s)},head:function(n,r){return e.head(t+n,r)},patch:function(n,r,i){return e.patch(t+n,r,i)},"delete":function(n,r){return e.delete(t+n,r)},list:function(){var t=e.config.name,r,i=0;return typeof arguments[i]=="string"&&(t=arguments[i++]),typeof arguments[i]=="function"&&(r=arguments[i++]),e.get(n+t,r)},"import":function(){var t=e.config.name,n={},r="",i,s=0;typeof arguments[s]=="boolean"&&(r="&createCollection=true",s++),typeof arguments[s]=="string"&&(t=arguments[s++]),typeof arguments[s]=="object"&&(n=arguments[s++]),typeof arguments[s]=="function"&&(i=arguments[s++])}}}}),define("api/index",["require"],function(e){return function(e){var t="/_api/index/",n="/_api/index?collection=";return{get:function(n,r){return e.get(t+n,r)},create:function(){var t=e.config.name,r={},i,s=0;return typeof arguments[s]=="string"&&(t=arguments[s++]),typeof arguments[s]=="object"&&(r=arguments[s++]),typeof arguments[s]=="function"&&(i=arguments[s++]),e.post(n+t,r,i)},"delete":function(n,r){return e.delete(t+n,r)},list:function(){var t=e.config.name,r,i=0;return arguments.length>0&&(typeof arguments[i]=="string"&&(t=arguments[i++]),typeof arguments[i]=="function"&&(r=arguments[i++])),e.get(n+t,r)}}}}),define("api/edge",["require"],function(e){return function(e){function i(t,n,r,i){var s={};return s[t]=JSON.stringify(r),e.raw({headers:s},n,null,i)}function s(t,n,r,i,s){var o={};return o[t]=JSON.stringify(r),e.raw({method:"PUT",headers:o},n,i,s)}var t="/_api/edge/",n="/_api/edge?collection=",r="/_api/edges/";return{get:function(n,r){return e.get(t+n,r)},getIfNoneMatch:function(e,n,r){return i("If-None-Match",t+e,n,r)},getIfMatch:function(e,n,r){return i("If-Match",t+e,n,r)},create:function(){var t,r,i,s={},o,u=0;return typeof arguments[u]=="string"&&(t=arguments[u++]),typeof arguments[u]=="string"&&(r=arguments[u++]),typeof arguments[u]=="string"&&(i=arguments[u++]),typeof arguments[u]=="object"&&(s=arguments[u++]),typeof arguments[u]=="function"&&(o=arguments[u++]),i||(i=r,r=t,t=e.config.name),e.post(n+t+"&from="+r+"&to="+i,s,o)},put:function(n,r,i){return e.put(t+n,r,i)},putIfNoneMatch:function(e,n,r,i){return s("if-none-match",t+e,n,r,i)},putIfMatch:function(e,n,r,i){return s("if-match",t+e,n,r,i)},head:function(n,r){return e.head(t+n,r)},patch:function(n,r,i){return e.patch(t+n,r,i)},"delete":function(n,r){return e.delete(t+n,r)},list:function(){var t,n,i,s,o=0;arguments.length>0&&(typeof arguments[o]=="string"&&(t=arguments[o++]),typeof arguments[o]=="string"&&(n=arguments[o++]),typeof arguments[o]=="string"&&(i=arguments[o++]),typeof arguments[o]=="function"&&(s=arguments[o++])),i||(i=n||"any",n=t,t=e.config.name);var u="?vertex="+n+"&direction="+i;return e.get(r+t+u,s)}}}}),define("api/key",["require"],function(e){return function(e){function r(t,n,r,i,s){var o={},u;return typeof r.expires=="object"?u=r.expires:u=new Date(Date.parse(r.expires,"yyyy-MM-dd HH:MM:SS")),o["x-voc-expires"]=u.toISOString(),r.extended&&(o["x-voc-extended"]=JSON.stringify(r.extended)),e.raw({method:t,headers:o},n,i,s)}function i(e){return e.replace(/^[.\/]*/,"")}var t="/_api/key/",n="/_api/keys/";return{get:function(){var n=e.config.name,r,s,o=0;return typeof arguments[o+1]=="string"&&(n=arguments[o++]),typeof arguments[o]=="string"&&(r=arguments[o++]),typeof arguments[o]=="function"&&(s=arguments[o++]),e.get(t+n+"/"+i(r),s)},create:function(){var n=e.config.name,s,o={},u={},a,f=0;return typeof arguments[f+1]=="string"&&(n=arguments[f++]),typeof arguments[f]=="string"&&(s=arguments[f++]),o=arguments[f++],u=arguments[f++],typeof arguments[f]=="function"&&(a=arguments[f++]),r("POST",t+n+"/"+i(s),o,u,a)},put:function(){var n=e.config.name,s,o={},u={},a,f=0;return typeof arguments[f+1]=="string"&&(n=arguments[f++]),typeof arguments[f]=="string"&&(s=arguments[f++]),o=arguments[f++],u=arguments[f++],typeof arguments[f]=="function"&&(a=arguments[f++]),r("PUT",t+n+"/"+i(s)+"?create=1",o,u,a)},list:function(){var t=e.config.name,r,s,o=0;return typeof arguments[o+1]=="string"&&(t=arguments[o++]),typeof arguments[o]=="string"&&(r=arguments[o++]),typeof arguments[o]=="function"&&(s=arguments[o++]),e.get(n+t+"/"+i(r),s)},"delete":function(){var n=e.config.name,r,s,o=0;return typeof arguments[o+1]=="string"&&(n=arguments[o++]),typeof arguments[o]=="string"&&(r=arguments[o++]),typeof arguments[o]=="function"&&(s=arguments[o++]),e.delete(t+n+"/"+i(r),s)}}}}),define("api/session",["require"],function(e){return function(e){function t(t){var n="/_admin/user-manager/session";e.post(n,null,t)}return{login:function(n){t(function(t,r){t&&n(t,r);if(e.config.user&&e.config.user.length>0){var i="/_admin/user-manager/session/"+r.sid+"/login",s={user:e.config.user,password:e.config.pass};return e.put(i,s,function(t,r){t||(e._sid=r.sid,e._rights=r.rights),n&&n.apply(this,arguments)})}n&&n(0,r)})},logout:function(t){var n="/_admin/user-manager/session/"+e._sid+"/logout";return e.put(n,null,function(){e._sid=undefined,e._rights=undefined,t.apply(this,arguments)})},users:function(t){var n="/_admin/user-manager/users";return e.get(n,t)},createUser:function(t,n,r,i){var s="/_admin/user-manager/user/"+n,o=e.hashPass(r),u={role:t,password:o};return e.post(s,u,i)},changePass:function(t,n){var r="/_admin/user-manager/session/"+e._sid+"/password";return e.put(r,{password:e.hashPass(t)},n)}}}}),define("api/admin",["require"],function(e){return function(e){var t="/_admin/";return{status:function(n){return e.get(t+"status",n)},log:function(){var n="",r,i=0;return typeof arguments[i]=="string"&&(severity="?level="+arguments[i++]),typeof arguments[i]=="object"&&Object.keys(arguments[i++]).forEach(function(e){severity+=severity.length?"&":"?",severity+=e+"="+arguments[i][e]}),typeof arguments[i]=="function"&&(r=arguments[i++]),e.get(t+"log"+severity,r)},getConfig:function(n){return e.get(t+"config/configuration",n)},describeConfig:function(n){return e.get(t+"config/description",n)},listUsers:function(n){return e.get(t+"user-manager/users",n)},getUser:function(n,r){return e.get(t+"user-manager/user/"+n,r)},routes:function(n){return e.get(t+"routing/routes",n)},routesReload:function(n){return e.get(t+"routing/reload",n)}}}}),define("api/simple",["require"],function(e){return function(e){function i(e,t){return typeof t=="object"&&Object.keys(t).forEach(function(i){switch(i){case"from":e.left=t[i],e.closed=!0;break;case"to":e.right=t[i],e.closed=!0;break;default:e[i]=t[i]}n&&!e.skip&&(e.skip=n),r&&!e.limit&&(e.limit=r)}),e}var t="/_api/simple/",n,r;return{list:function(){var n={collection:e.config.name},r=0,s,o;return typeof arguments[r]=="string"&&(n.collection=arguments[r++]),typeof arguments[r]=="object"&&(s=arguments[r++]),typeof arguments[r]=="function"&&(o=arguments[r++]),e.put(t+"all",i(n),o)},example:function(){var n={collection:e.config.name},r=0,s,o;return typeof arguments[r]=="string"&&(n.collection=arguments[r++]),typeof arguments[r]=="object"&&typeof arguments[r+1]=="object"&&(s=arguments[r++]),typeof arguments[r]=="object"&&(n.example=arguments[r++]),typeof arguments[r]=="function"&&(o=arguments[r++]),e.put(t+"by-example",i(n),o)},first:function(){var n={collection:e.config.name},r=0,i,s;return typeof arguments[r]=="string"&&(n.collection=arguments[r++]),typeof arguments[r]=="object"&&(n.example=arguments[r++]),typeof arguments[r]=="function"&&(s=arguments[r++]),e.put(t+"first-example",n,s)},range:function(){var n={collection:e.config.name},r=0,s,o;return typeof arguments[r]=="string"&&(n.collection=arguments[r++]),typeof arguments[r]=="object"&&(s=arguments[r++]),typeof arguments[r]=="function"&&(o=arguments[r++]),e.put(t+"range",i(n),o)},near:function(){var n={collection:e.config.name},r=0,s,o;return typeof arguments[r]=="string"&&(n.collection=arguments[r++]),typeof arguments[r]=="object"&&(s=arguments[r++]),typeof arguments[r]=="function"&&(o=arguments[r++]),e.put(t+"near",i(n),o)},within:function(){var n={collection:e.config.name},r=0,s,o;return typeof arguments[r]=="string"&&(n.collection=arguments[r++]),typeof arguments[r]=="object"&&(s=arguments[r++]),typeof arguments[r]=="function"&&(o=arguments[r++]),e.put(t+"within",i(n),o)},skip:function(e){n=e},limit:function(e){r=e}}}}),define("arango",["require","./utils","./query","./request","./ext/sha256","./api/cursor","./api/collection","./api/document","./api/index","./api/edge","./api/key","./api/session","./api/admin","./api/simple"],function(e){function s(){function a(e){var t=r.sha256hex;return e&&e.length>0?e.length===64?e:t(e).toString():""}var e=this,t={},s=0;if(typeof arguments[s]=="string"){var o=/^(?:([A-Za-z]+):)?(\/{0,3})(?:([^\x00-\x1F\x7F:]+)?:?([^\x00-\x1F\x7F:]*)@)?([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?$/,u=o.exec(arguments[s++]);if(!u)throw new Error("invalid connection string");t.protocol=u[1],t.user=u[3],t.pass=u[4],t.host=u[5],t.port=u[6],t.name=u[7]}typeof arguments[s]=="object"&&i.extend(t,arguments[s++]),typeof arguments[s]=="function"&&(this.callback=arguments[s++]),this.config={server:{protocol:t.protocol||(n?n.protocol.split(":")[0]:"http"),hostname:t.host||(n?n.hostname:"127.0.0.1"),port:parseInt(t.port,10)||(n?n.port:8529)},user:t.user||"",_pass:t.pass||"",name:t.name||""},Object.defineProperty(this.config,"pass",{get:function(){return this._pass},set:function(e){this._pass=a(e)}}),this.hashPass=a,this.config._pass.length!==64&&(this.config.pass=this.config._pass);for(var f in r.api)this[f]=r.api[f](this);var l=r.request(this);for(var c in l)this[c]=l[c];this.query=r.query(this)}var t=typeof window=="object"&&window.hasOwnProperty("location"),n=t?window.location:!1,r={},i=e("./utils");return r.query=e("./query"),r.request=e("./request"),r.sha256hex=e("./ext/sha256").SHA256,r.api={cursor:e("./api/cursor"),collection:e("./api/collection"),document:e("./api/document"),index:e("./api/index"),edge:e("./api/edge"),key:e("./api/key"),session:e("./api/session"),admin:e("./api/admin"),simple:e("./api/simple")},{Connection:s}})
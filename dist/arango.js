/*Copyright (c) Kaerus 2012 (kaerus.com), Anders Elo <anders @ kaerus com>*/
define("utils",["require"],function(e){function t(){var e=!1,n={},r=0;typeof arguments[r]=="boolean"&&(e=arguments[r++]),typeof arguments[r+1]=="object"&&(n=arguments[r++]);for(var i;i=arguments[r];r++)n=Object.keys(i).reduce(function(n,r){return i.hasOwnProperty(r)&&(typeof i[r]=="object"?e&&(n[r]=t(!0,n[r],i[r])):i[r]&&(n[r]=i[r])),n},n);return n}function n(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}function r(e){if(!(this instanceof r))return new r;this._events={}}function i(e){var t=/^(?:([A-Za-z]+):)?(\/{0,3})(?:([^\x00-\x1F\x7F:]+)?:?([^\x00-\x1F\x7F:]*)@)?([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^\x00-\x1F\x7F]+))?$/,n=t.exec(e);if(!n)return!1;var r=/^([\w\-]+)?(?:#([\w\-]+))?(?:\:([\w\-]+))?(?:\?(.*))?$/,i=r.exec(n[7]);return n?{uriparts:n,protocol:n[1],username:n[3],password:n[4],hostname:n[5],port:n[6],path:i?{first:i[1],hash:i[2],base:i[3],query:i[4],string:n[7]}:n[7]}:!1}return r.prototype.on=function(e,t){return e in this._events||(this._events[e]=[]),this._events[e].indexOf(t)<0&&this._events[e].push(t),this},r.prototype.off=function(e,t){if(!this._events[e])return this;var n=this._events[e].indexOf(t);return n>=0&&(this._events[e].splice(n,1),this._events[e].length===0&&delete this._events[e]),this},r.prototype.emit=function(e){if(!this._events[e])return!1;var t=Array.prototype.slice.call(arguments,1),n,r=[],i=!1;for(var s=0,o=this._events[e].length;s<o;s++){n=this._events[e][s];if(typeof n=="function"){if(n.apply(this,t)===!1){i=!0;break}}else{if(typeof n!="object")throw"No valid event handler found";typeof n.after=="function"&&r.push(n.after)}}return r.forEach(function(e){i||e.apply(this,t)===!1&&(i=!0)}),this},r.prototype.once=function(e,t){var n=this;return this.on(e,function r(){n.off(e,r),t.apply(this,arguments)}),this},r.prototype.after=function(e,t){return e in this._events||(this._events[e]=[]),this._events[e].indexOf({after:t})<0&&this._events[e].push({after:t}),this},{extend:t,inherit:n,Emitter:r,parseUrl:i}}),define("action",["require","./utils"],function(e){var t=e("./utils");return function(e){function r(){}var n=e.request;return r.prototype.define=function(e,r,i){function o(){var e=Array.prototype.splice.call(arguments);return e[0]&&typeof e[0]=="object"&&t.extend(!0,i,e.shift()),e.unshift(r.path?r.path.string?r.path.string:r.path:""),e.unshift(i),n.raw.apply(s,e)}var s=this;return typeof e!="string"||typeof r!="string"?!1:(r=t.parseUrl(r))?(i||(i={}),i.method=i.method?i.method.toUpperCase():"GET",i.protocol=r.protocol||"http",i.hostname=r.hostname||"127.0.0.1",i.port=parseInt(r.port,10)||80,this[e]=o,this):!1},new r}}),define("query",["require","./utils"],function(e){var t=e("./utils");return function(e){function n(){function r(n){var i=n||t.struct;return e.filter(function(e){return i[e]?!0:!1}).map(function(e){var t=e.toUpperCase(),n=i[e];switch(t){case"FROM":t="IN";break;case"INCLUDE":t="";break;default:}if(typeof n=="object"){var s=r(n);return e==="in"?t+" ( "+s+" )":t+" "+s}return t+" "+n}).join(" ")}var e=["for","in","filter","from","include","collect","into","sort","limit","return"],t=this;e.forEach(function(e){t[e]=function(){t.struct||(t.struct={});if(!arguments.length)return t.struct[e];var r=Array.prototype.slice.call(arguments);return typeof r[0]=="function"?t.struct[e]=function(e){var t=new n;return e.apply(t),t.struct}(r[0]):t.struct[e]=r.join(" "),t}}),t.toString=r}function r(){function i(n,i){var s,o=0,u=Array.prototype.slice.call(i);return r.string?s=t.extend({query:r.string},r.options):typeof u[o]=="string"?s=t.extend({query:u[o++]},r.options):typeof u[o]=="object"&&u[o].struct?s=t.extend({query:u[o++].struct.toString()},r.options):s=t.extend({query:u[o++].toString()},r.options),typeof u[o]=="object"&&t.extend(s,{bindVars:u[o++]}),e.cursor[n](s,u[o])}var r=this;n.call(this),r.string={},r.new=function(){return new n},Object.defineProperty(this,"string",{get:function(){return r.struct?r.toString():this._string},set:function(e){this._string=e,r.struct=null}}),r.options={},r.count=function(e){return r.options.count=e>0?!0:!1,r.options.batchSize=e>0?e:undefined,r},r.test=function(){return i("query",arguments)},r.explain=function(){return i("explain",arguments)},r.exec=function(){var t=function(e){this.emit("error",e)},n=function(r,i){e.cursor.get(r.id,callback).on("result",n).on("error",t),this.emit("next",r,i)},r=i("create",arguments).on("result",n)}}return t.inherit(r,n),new r}}),define("ajax",["require","./utils"],function(e){function r(e,t){var n={NOXHR:[1e3,"Ajax is not supported"],REQUEST:[1001,"Request operation failed"],UNIMPLEMENTED:[1002,"no such feature"]};return{name:"Ajax",type:e,code:n[e][0],message:n[e][1]+(t?": "+t:"")}}function c(e,t){n.Emitter.call(this),this.data=[],this.data.size=0,this.on("response",t),this.after("end",function(){e.close()}),this.after("error",function(){e.close()})}function h(t,l){(function(){if(i==="nodejs"){var n=e(t.protocol||"http").request;h=function(e,t){return delete e.protocol,e.timeout&&(n.socket.setTimeout(e.timeout),delete e.timeout),n(e,t)}}})();if(!(this instanceof h))return new h(t,l);var p=this;p._send=[],p.xhr=new i,n.Emitter.call(this),t.timeout?(p._timeout=t.timeout,delete t.timeout):p._timeout=5e3,p.timeoutHandler=function(){p.xhr.abort()},p.response=new c(p,l),p.response.emit("response",p.response),p.xhr.onreadystatechange=function(){switch(p.xhr.readyState){case f:p.response.statusCode=p.xhr.status,p.response.headers||(p.response.headers=p.parseHeaders()),p.response.writeChunk(p.xhr.responseText),p.xhr.status?p.response.emit("end"):p.response.emit("error",r("REQUEST",p.xhr.statusText));break;case a:p.response.headers=p.parseHeaders(),p.response.writeChunk(p.xhr.responseText);break;case u:p.emit("ready");break;case o:break;case s:}},p.on("open",p.startTimer),p.on("close",p.clearTimer),p.request(t,l)}var t=typeof window=="object",n=e("./utils"),i=t?function(){var e,t;if(typeof window.XMLHttpRequest!="undefined")return window.XMLHttpRequest;if(typeof window.ActiveXObject!="undefined"){e="ActiveXObject";var n=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];for(var i=0,s=n.length;i<s;i++)try{return new window.ActiveXObject(n[i]),window.ActiveXObject(n[i])}catch(o){}throw r("NOXHR","XHR ActiveXObject failed")}throw r("NOXHR","XHR support not found")}():"nodejs",s=0,o=1,u=2,a=3,f=4,l=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];return n.inherit(c,n.Emitter),c.prototype.write=function(e){this.data.push(e),this.data.size+=e.length,this.emit("data",this.data[this.data.length-1])},c.prototype.writeChunk=function(e){e.length>this.data.size&&this.write(e.slice(this.data.size))},n.inherit(h,n.Emitter),h.prototype.write=function(e){return this._send.push(e),this},h.prototype.end=function(e){e&&this._send.push(e),this.xhr.send(this._send.length>0?this._send.join(""):null)},h.prototype.close=function(){this.emit("close")},h.prototype.parseHeaders=function(){var e={},t,n,r,i=this.xhr.getAllResponseHeaders();return i.split("\n").forEach(function(i){r=i.indexOf(":"),t=i.slice(0,r).replace(/^[\s]+|[\s]+$/g,"").toLowerCase(),n=i.slice(r+1,i.length).replace(/^[\s]+|[\s]+$/g,""),t&&t.length&&(e[t]=n)}),e},h.prototype.request=function(e,n){var r=e.protocol==="file"&&t,i=r?"http://127.0.0.1:8529"+e.path:e.protocol+"://"+e.hostname+":"+e.port+e.path;e.method=e.method||"GET",e.headers||(e.headers={}),e.headers["content-type"]||(e.headers["content-type"]="application/json"),this.xhr.open(e.method,i,!0),this.emit("open",e.method,i),Object.keys(e.headers).forEach(function(n){n=n.toLowerCase(),(!t||l.indexOf(n)<0)&&this.xhr.setRequestHeader(n,e.headers[n])},this)},h.prototype.startTimer=function(){this.timer=setTimeout(this.timeoutHandler,this._timeout)},h.prototype.clearTimer=function(){clearTimeout(this.timer)},h.prototype.resetTimer=function(){clearTimeout(this.timer),this.startTimer()},{request:h}}),function(e){if(typeof bootstrap=="function")bootstrap("promise",e);else if(typeof exports=="object")e(void 0,exports);else if(typeof define=="function")define("ext/q",[],e);else if(typeof ses!="undefined"){if(!ses.ok())return;ses.makeQ=function(){var t={};return e(void 0,t)}}else e(void 0,Q={})}(function(e,t){function b(e){return y(e)==="[object StopIteration]"||e instanceof w}function E(e,t){var n=[];try{n.push(e.toString())}catch(r){try{n.push("<error: "+r+">")}catch(i){n.push("<error>")}}for(var s=0;s<t.length;s++){var o=t[s],u;if(typeof o=="string")n.push(o);else{try{u=S(o)}catch(r){try{u="<error: "+r+">"}catch(i){u="<error>"}}n.push("    at "+u)}}return n.join("\n")}function S(e){var t="";if(e.isNative())t="native";else if(e.isEval())t="eval at "+e.getEvalOrigin();else{var n=e.getFileName();if(n){t+=n;var r=e.getLineNumber();if(r!==null){t+=":"+r;var i=e.getColumnNumber();i&&(t+=":"+i)}}}t||(t="unknown source");var s="",o=e.getFunction().name,u=!0,a=e.isConstructor(),f=!e.isToplevel()&&!a;if(f){var l=e.getMethodName();s+=e.getTypeName()+".",o?(s+=o,l&&l!==o&&(s+=" [as "+l+"]")):s+=l||"<anonymous>"}else a?s+="new "+(o||"<anonymous>"):o?s+=o:(s+=t,u=!1);return u&&(s+=" ("+t+")"),s}function x(e,t){if(e!==r)return!1;var i=t.getLineNumber();return i>=n&&i<=wt}function T(e){var t=Error.prepareStackTrace;Error.prepareStackTrace=function(e,t){return t.filter(function(e){var t=e.getFileName();return t!=="module.js"&&t!=="node.js"&&!x(t,e)})};var n=e.stack;return Error.prepareStackTrace=t,n}function N(){if(Error.captureStackTrace){var e,t,n=Error.prepareStackTrace;return Error.prepareStackTrace=function(n,r){e=r[1].getFileName(),t=r[1].getLineNumber()},(new Error).stack,Error.prepareStackTrace=n,r=e,t}}function C(e,t,n){return function(){return typeof console!="undefined"&&typeof console.warn=="function"&&console.warn(t+" is deprecated, use "+n+" instead.",(new Error("")).stack),e.apply(e,arguments)}}function k(){function u(r){if(!e)return;n=q(r),p(e,function(e,t){o(function(){n.promiseSend.apply(n,t)})},void 0),e=void 0,t=void 0}var e=[],t=[],n,r=m(k.prototype),i=m(A.prototype);return i.promiseSend=function(r,i,s,u){var a=h(arguments);e?(e.push(a),r==="when"&&u&&t.push(u)):o(function(){n.promiseSend.apply(n,a)})},i.valueOf=function(){return e?i:n.valueOf()},Error.captureStackTrace&&Error.captureStackTrace(i,k),s(i),r.promise=i,r.resolve=u,r.reject=function(e){u(I(e))},r.notify=function(n){e&&p(t,function(e,t){o(function(){t(n)})},void 0)},r}function L(e){var t=k();return rt(e,t.resolve,t.reject,t.notify).fail(t.reject),t.promise}function A(e,t,n,r){t===void 0&&(t=function(e){return I(new Error("Promise does not support operation: "+e))});var i=m(A.prototype);return i.promiseSend=function(n,r){var s=h(arguments,2),o;try{e[n]?o=e[n].apply(i,s):o=t.apply(i,[n].concat(s))}catch(u){o=I(u)}r&&r(o)},n&&(i.valueOf=n),r&&(i.exception=r),s(i),i}function O(e){return Object(e)!==e?e:M(e)?e.valueOf():e}function M(e){return e&&typeof e.promiseSend=="function"}function _(e){return D(e)||P(e)}function D(e){return!M(O(e))}function P(e){return e=O(e),M(e)&&"exception"in e}function F(){!j&&typeof window!="undefined"&&!window.Touch&&window.console&&console.log("Should be empty:",B),j=!0}function I(e){e=e||new Error;var t=A({when:function(t){if(t){var n=d(H,this);n!==-1&&(B.splice(n,1),H.splice(n,1))}return t?t(e):I(e)}},function(){return I(e)},function n(){return this},e);return F(),H.push(t),B.push(e),t}function q(e){if(M(e))return e;e=O(e);if(e&&typeof e.then=="function"){var t=k();return e.then(t.resolve,t.reject,t.notify),t.promise}return A({when:function(){return e},get:function(t){return e[t]},put:function(t,n){return e[t]=n,e},del:function(t){return delete e[t],e},post:function(t,n){return e[t].apply(e,n)},apply:function(t,n){return e.apply(t,n)},fapply:function(t){return e.apply(void 0,t)},viewInfo:function(){function r(e){n[e]||(n[e]=typeof t[e])}var t=e,n={};while(t)Object.getOwnPropertyNames(t).forEach(r),t=Object.getPrototypeOf(t);return{type:typeof e,properties:n}},keys:function(){return g(e)}},void 0,function n(){return e})}function R(e){return A({isDef:function(){}},function(){var n=h(arguments);return Q.apply(void 0,[e].concat(n))},function(){return O(e)})}function U(e,t){return e=q(e),t?A({viewInfo:function(){return t}},function(){var n=h(arguments);return Q.apply(void 0,[e].concat(n))},function(){return O(e)}):Q(e,"viewInfo")}function z(e){return U(e).when(function(t){var n;t.type==="function"?n=function(){return et(e,void 0,arguments)}:n={};var r=t.properties||{};return g(r).forEach(function(t){r[t]==="function"&&(n[t]=function(){return Z(e,t,arguments)})}),q(n)})}function W(e,t,n,r){function u(e){try{return t?t(e):e}catch(n){return I(n)}}function a(e){try{return n?n(e):I(e)}catch(t){return I(t)}}function f(e){return r?r(e):e}var i=k(),s=!1,l=q(e);return o(function(){l.promiseSend("when",function(e){if(s)return;s=!0,i.resolve(u(e))},function(e){if(s)return;s=!0,i.resolve(a(e))})}),l.promiseSend("when",void 0,void 0,function(e){i.notify(f(e))}),i.promise}function X(e,t,n){return W(e,function(e){return ot(e).then(function(e){return t.apply(void 0,e)},n)},n)}function V(e){return function(){function t(e,t){var s;try{s=n[e](t)}catch(o){return b(o)?o.value:I(o)}return W(s,r,i)}var n=e.apply(this,arguments),r=t.bind(t,"send"),i=t.bind(t,"throw");return r()}}function $(e){throw new w(e)}function J(e){return function(){return ot([this,ot(arguments)]).spread(function(t,n){return e.apply(t,n)})}}function K(e){return function(t){var n=h(arguments,1);return Q.apply(void 0,[t,e].concat(n))}}function Q(e,t){var n=k(),r=h(arguments,2);return e=q(e),o(function(){e.promiseSend.apply(e,[t,n.resolve].concat(r))}),n.promise}function G(e,t,n){var r=k();return e=q(e),o(function(){e.promiseSend.apply(e,[t,r.resolve].concat(n))}),r.promise}function Y(e){return function(t){var n=h(arguments,1);return G(t,e,n)}}function nt(e,t){var n=h(arguments,2);return et(e,t,n)}function rt(e){var t=h(arguments,1);return tt(e,t)}function it(e,t){var n=h(arguments,2);return function(){var i=n.concat(h(arguments));return et(e,t,i)}}function st(e){var t=h(arguments,1);return function(){var r=t.concat(h(arguments));return tt(e,r)}}function ot(e){return W(e,function(e){var t=e.length;if(t===0)return q(e);var n=k();return p(e,function(r,i,s){D(i)?(e[s]=O(i),--t===0&&n.resolve(e)):W(i,function(r){e[s]=r,--t===0&&n.resolve(e)}).fail(n.reject)},void 0),n.promise})}function ut(e){return W(e,function(e){return W(ot(v(e,function(e){return W(e,i,i)})),function(){return v(e,q)})})}function at(e,t){return W(e,void 0,t)}function ft(e,t){return W(e,void 0,void 0,t)}function lt(e,t){return W(e,function(e){return W(t(),function(){return e})},function(e){return W(t(),function(){return I(e)})})}function ct(e,n,r,i){function s(n){o(function(){var r;if(Error.captureStackTrace&&typeof n=="object"&&(r=T(n))){var i=T(e);if(typeof r!="string"){var s=r.concat("From previous event:",i);n.stack=E(n,s)}}if(!t.onerror)throw n;t.onerror(n)})}var u=n||r||i?W(e,n,r,i):e;at(u,s)}function ht(e,t){var n=k(),r=setTimeout(function(){n.reject(new Error("Timed out after "+t+" ms"))},t);return W(e,function(e){clearTimeout(r),n.resolve(e)},n.reject),n.promise}function pt(e,t){t===void 0&&(t=e,e=void 0);var n=k();return setTimeout(function(){n.resolve(e)},t),n.promise}function dt(e,t,n){return mt(e,t).apply(void 0,n)}function vt(e,t){var n=h(arguments,2);return dt(e,t,n)}function mt(e){if(arguments.length>1){var t=arguments[1],n=h(arguments,2),r=e;e=function(){var e=n.concat(h(arguments));return r.apply(t,e)}}return function(){var t=k(),n=h(arguments);return n.push(t.makeNodeResolver()),tt(e,n).fail(t.reject),t.promise}}function gt(e,t,n){var r=h(n),i=k();return r.push(i.makeNodeResolver()),Z(e,t,r).fail(i.reject),i.promise}function yt(e,t){var n=h(arguments,2),r=k();return n.push(r.makeNodeResolver()),Z(e,t,n).fail(r.reject),r.promise}function bt(e,t){if(!t)return e;e.then(function(e){o(function(){t(null,e)})},function(e){o(function(){t(e)})})}var n=N(),r,i=function(){},s=Object.freeze||i;typeof cajaVM!="undefined"&&(s=cajaVM.def);var o;if(typeof process!="undefined")o=process.nextTick;else if(typeof setImmediate=="function")o=setImmediate;else if(typeof MessageChannel!="undefined"){var u=new MessageChannel,a={},f=a;u.port1.onmessage=function(){a=a.next;var e=a.task;delete a.task,e()},o=function(e){f=f.next={task:e},u.port2.postMessage(0)}}else o=function(e){setTimeout(e,0)};var l;if(Function.prototype.bind){var c=Function.prototype.bind;l=c.bind(c.call)}else l=function(e){return function(){return e.call.apply(e,arguments)}};var h=l(Array.prototype.slice),p=l(Array.prototype.reduce||function(e,t){var n=0,r=this.length;if(arguments.length===1)do{if(n in this){t=this[n++];break}if(++n>=r)throw new TypeError}while(1);for(;n<r;n++)n in this&&(t=e(t,this[n],n));return t}),d=l(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),v=l(Array.prototype.map||function(e,t){var n=this,r=[];return p(n,function(i,s,o){r.push(e.call(t,s,o,n))},void 0),r}),m=Object.create||function(e){function t(){}return t.prototype=e,new t},g=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t},y=Object.prototype.toString,w;typeof ReturnValue!="undefined"?w=ReturnValue:w=function(e){this.value=e},t.nextTick=o,t.defer=k,k.prototype.makeNodeResolver=function(){var e=this;return function(t,n){t?e.reject(t):arguments.length>2?e.resolve(h(arguments,1)):e.resolve(n)}},k.prototype.node=C(k.prototype.makeNodeResolver,"node","makeNodeResolver"),t.promise=L,t.makePromise=A,A.prototype.then=function(e,t,n){return W(this,e,t,n)},A.prototype.thenResolve=function(e){return W(this,function(){return e})},p(["isResolved","isFulfilled","isRejected","when","spread","send","get","put","del","post","invoke","keys","apply","call","bind","fapply","fcall","fbind","all","allResolved","view","viewInfo","timeout","delay","catch","finally","fail","fin","progress","end","done","ncall","napply","nbind","npost","ninvoke","nend","nodeify"],function(e,n){A.prototype[n]=function(){return t[n].apply(t,[this].concat(h(arguments)))}},void 0),A.prototype.toSource=function(){return this.toString()},A.prototype.toString=function(){return"[object Promise]"},s(A.prototype),t.nearer=O,t.isPromise=M,t.isResolved=_,t.isFulfilled=D,t.isRejected=P;var H=[],B=[],j;t.reject=I,t.begin=q,t.resolve=q,t.ref=C(q,"ref","resolve"),t.master=R,t.viewInfo=U,t.view=z,t.when=W,t.spread=X,t.async=V,t["return"]=$,t.promised=J,t.sender=C(K,"sender","dispatcher"),t.Method=C(K,"Method","dispatcher"),t.send=C(Q,"send","dispatch"),t.dispatch=G,t.dispatcher=Y,t.get=Y("get"),t.put=Y("put"),t["delete"]=t.del=Y("del");var Z=t.post=Y("post");t.invoke=function(e,t){var n=h(arguments,2);return Z(e,t,n)};var et=t.apply=C(Y("apply"),"apply","fapply"),tt=t.fapply=Y("fapply");t.call=C(nt,"call","fcall"),t["try"]=rt,t.fcall=rt,t.bind=C(it,"bind","fbind"),t.fbind=st,t.keys=Y("keys"),t.all=ot,t.allResolved=ut,t["catch"]=t.fail=at,t.progress=ft,t["finally"]=t.fin=lt,t.end=C(ct,"end","done"),t.done=ct,t.timeout=ht,t.delay=pt,t.napply=dt,t.ncall=vt,t.nbind=mt,t.npost=gt,t.ninvoke=yt,t.nend=C(bt,"nend","nodeify"),t.nodeify=bt;var wt=N()}),define("request",["require","./utils","./ajax","./ext/q"],function(e){function i(e,t,i){var s=r.defer(),o=n.request(e,function(e){var t={},n;typeof e.data!="object"&&(e.data=[],e.on("data",function(t){e.data.push(t)})),e.on("end",function(){if(e.data.length>0)try{t=JSON.parse(e.data.join(""))}catch(r){t=e.data.join("")}t.error?n={code:e.statusCode,message:t.errorMessage}:e.error?n={code:e.statusCode,message:t.message}:typeof t.error=="undefined"&&(n={code:e.statusCode,message:t.message}),n?s.reject(n):s.resolve(t)})}).on("error",function(e){s.reject(e)});return t&&o.write(t),o.end(),i&&s.promise.then(i),s.promise}var t=e("./utils"),n=e("./ajax"),r=e("./ext/q");return function(e){function n(n,r,s,o){try{s=s&&!s.length?new Buffer(JSON.stringify(s)):s}catch(u){s=JSON.stringify(s)}return n=t.extend(!0,{path:r,headers:{"content-type":"application/json",connection:"keep-alive","content-length":s?s.length:0}},e.server,n),i(n,s,o)}return{post:function(e,t,r){return n({method:"POST"},e,t,r)},get:function(e,t){return n({method:"GET"},e,null,t)},put:function(e,t,r){return n({method:"PUT"},e,t,r)},"delete":function(e,t){return n({method:"DELETE"},e,null,t)},patch:function(e,t,r){return n({method:"PATCH"},e,t,r)},head:function(e,t){return n({method:"HEAD"},e,null,t)},raw:function(e,t,r,i){return n(e,t,r,i)}}}}),define("api/collection",["require"],function(e){return function(e){var t=e.request,n="/_api/collection/";return{create:function(){var r=e.name,i={},s,o=0;return typeof arguments[o]=="string"&&(r=arguments[o++]),typeof arguments[o]=="object"&&(i=arguments[o++]),typeof arguments[o]=="function"&&(s=arguments[o++]),i.name||(i.name=r),t.post(n,i,s)},get:function(e,r){return t.get(n+e,r)},"delete":function(e,r){return t.delete(n+e,r)},truncate:function(e,r){return t.put(n+e+"/truncate",null,r)},count:function(e,r){return t.get(n+e+"/count",r)},figures:function(e,r){return t.get(n+e+"/figures",r)},list:function(e){return t.get(n,e)},load:function(e,r){return t.put(n+e+"/load",null,r)},unload:function(e,r){return t.put(n+e+"/unload",null,r)},rename:function(e,r,i){return typeof r=="string"&&(r={name:r}),t.put(n+e+"/rename",r,i)},getProperties:function(e,r){return t.get(n+e+"/properties",r)},setProperties:function(e,r,i){return t.put(n+e+"/properties",r,i)}}}}),define("api/document",["require"],function(e){return function(e){function i(e,n,r,i){var s={};return s[e]=JSON.stringify(r),t.raw({headers:s},n,null,i)}function s(e,n,r,i,s){var o={};return o[e]=JSON.stringify(r),t.raw({method:"PUT",headers:o},n,i,s)}var t=e.request,n="/_api/document/",r="/_api/document?collection=";return{create:function(){var n=e.name,i={},s="",o,u=0;return typeof arguments[u]=="boolean"&&arguments[u]===!0&&(s="&createCollection=true",u++),typeof arguments[u]=="string"&&(n=arguments[u++]),typeof arguments[u]=="object"&&(i=arguments[u++]),typeof arguments[u]=="function"&&(o=arguments[u++]),t.post(r+n+s,i,o)},get:function(e,r){return t.get(n+e,r)},getIfNoneMatch:function(e,t,r){return i("If-None-Match",n+e,t,r)},getIfMatch:function(e,t,r){return i("If-Match",n+e,t,r)},put:function(e,r,i){return t.put(n+e,r,i)},putIfNoneMatch:function(e,t,r,i){return s("if-none-match",n+e,t,r,i)},putIfMatch:function(e,t,r,i){return s("if-match",n+e,t,r,i)},head:function(e,r){return t.head(n+e,r)},patch:function(e,r,i){return t.patch(n+e,r,i)},"delete":function(e,r){return t.delete(n+e,r)},list:function(){var n=e.name,i,s=0;return typeof arguments[s]=="string"&&(n=arguments[s++]),typeof arguments[s]=="function"&&(i=arguments[s++]),t.get(r+n,i)},"import":function(){var t=e.name,n={},r="",i,s=0;typeof arguments[s]=="boolean"&&(r="&createCollection=true",s++),typeof arguments[s]=="string"&&(t=arguments[s++]),typeof arguments[s]=="object"&&(n=arguments[s++]),typeof arguments[s]=="function"&&(i=arguments[s++])}}}}),define("api/cursor",["require"],function(e){return function(e){var t=e.request,n="/_api/cursor/";return{get:function(e,r){return t.put(n+e,{},r)},create:function(e,r){return t.post(n,e,r)},query:function(e,n){return t.post("/_api/query",e,n)},explain:function(e,n){return t.post("/_api/explain",e,n)},"delete":function(e,r){return t.delete(n+e,r)}}}}),define("api/simple",["require"],function(e){return function(e){function s(e,t){return typeof t=="object"&&Object.keys(t).forEach(function(n){switch(n){case"from":e.left=t[n],e.closed=!0;break;case"to":e.right=t[n],e.closed=!0;break;default:e[n]=t[n]}r&&!e.skip&&(e.skip=r),i&&!e.limit&&(e.limit=i)}),e}var t=e.request,n="/_api/simple/",r,i;return{list:function(){var r={collection:e.name},i=0,o,u;return typeof arguments[i]=="string"&&(r.collection=arguments[i++]),typeof arguments[i]=="object"&&(o=arguments[i++]),typeof arguments[i]=="function"&&(u=arguments[i++]),t.put(n+"all",s(r),u)},example:function(){var r={collection:e.name},i=0,o,u;return typeof arguments[i]=="string"&&(r.collection=arguments[i++]),typeof arguments[i]=="object"&&typeof arguments[i+1]=="object"&&(o=arguments[i++]),typeof arguments[i]=="object"&&(r.example=arguments[i++]),typeof arguments[i]=="function"&&(u=arguments[i++]),t.put(n+"by-example",s(r),u)},first:function(){var r={collection:e.name},i=0,s,o;return typeof arguments[i]=="string"&&(r.collection=arguments[i++]),typeof arguments[i]=="object"&&(r.example=arguments[i++]),typeof arguments[i]=="function"&&(o=arguments[i++]),t.put(n+"first-example",r,o)},range:function(){var r={collection:e.name},i=0,o,u;return typeof arguments[i]=="string"&&(r.collection=arguments[i++]),typeof arguments[i]=="object"&&(o=arguments[i++]),typeof arguments[i]=="function"&&(u=arguments[i++]),t.put(n+"range",s(r),u)},near:function(){var r={collection:e.name},i=0,o,u;return typeof arguments[i]=="string"&&(r.collection=arguments[i++]),typeof arguments[i]=="object"&&(o=arguments[i++]),typeof arguments[i]=="function"&&(u=arguments[i++]),t.put(n+"near",s(r),u)},within:function(){var r={collection:e.name},i=0,o,u;return typeof arguments[i]=="string"&&(r.collection=arguments[i++]),typeof arguments[i]=="object"&&(o=arguments[i++]),typeof arguments[i]=="function"&&(u=arguments[i++]),t.put(n+"within",s(r),u)},skip:function(e){r=e},limit:function(e){i=e}}}}),define("api/index",["require"],function(e){return function(e){var t=e.request,n="/_api/index/",r="/_api/index?collection=";return{get:function(e,r){return t.get(n+e,r)},create:function(){var n=e.name,i={},s,o=0;return typeof arguments[o]=="string"&&(n=arguments[o++]),typeof arguments[o]=="object"&&(i=arguments[o++]),typeof arguments[o]=="function"&&(s=arguments[o++]),t.post(r+n,i,s)},"delete":function(e,r){return t.delete(n+e,r)},list:function(){var n=e.name,i,s=0;return arguments.length>0&&(typeof arguments[s]=="string"&&(n=arguments[s++]),typeof arguments[s]=="function"&&(i=arguments[s++])),t.get(r+n,i)}}}}),define("api/admin",["require"],function(e){return function(e){var t=e.request,n="/_admin/";return{status:function(e){return t.get(n+"status",e)},log:function(){var e="",r,i=0;return typeof arguments[i]=="string"&&(severity="?level="+arguments[i++]),typeof arguments[i]=="object"&&Object.keys(arguments[i++]).forEach(function(e){severity+=severity.length?"&":"?",severity+=e+"="+arguments[i][e]}),typeof arguments[i]=="function"&&(r=arguments[i++]),t.get(n+"log"+severity,r)},getConfig:function(e){return t.get(n+"config/configuration",e)},describeConfig:function(e){return t.get(n+"config/description",e)},listUsers:function(e){return t.get(n+"user-manager/users",e)},getUser:function(e,r){return t.get(n+"user-manager/user/"+e,r)},routes:function(e){return t.get(n+"routing/routes",e)},routesReload:function(e){return t.get(n+"routing/reload",e)}}}}),define("api/edge",["require"],function(e){return function(e){function s(e,n,r,i){var s={};return s[e]=JSON.stringify(r),t.raw({headers:s},n,null,i)}function o(e,n,r,i,s){var o={};return o[e]=JSON.stringify(r),t.raw({method:"PUT",headers:o},n,i,s)}var t=e.request,n="/_api/edge/",r="/_api/edge?collection=",i="/_api/edges/";return{get:function(e,r){return t.get(n+e,r)},getIfNoneMatch:function(e,t,r){return s("If-None-Match",n+e,t,r)},getIfMatch:function(e,t,r){return s("If-Match",n+e,t,r)},create:function(){var n,i,s,o={},u,a=0;return typeof arguments[a]=="string"&&(n=arguments[a++]),typeof arguments[a]=="string"&&(i=arguments[a++]),typeof arguments[a]=="string"&&(s=arguments[a++]),typeof arguments[a]=="object"&&(o=arguments[a++]),typeof arguments[a]=="function"&&(u=arguments[a++]),s||(s=i,i=n,n=e.name),t.post(r+n+"&from="+i+"&to="+s,o,u)},put:function(e,r,i){return t.put(n+e,r,i)},putIfNoneMatch:function(e,t,r,i){return o("if-none-match",n+e,t,r,i)},putIfMatch:function(e,t,r,i){return o("if-match",n+e,t,r,i)},head:function(e,r){return t.head(n+e,r)},patch:function(e,r,i){return t.patch(n+e,r,i)},"delete":function(e,r){return t.delete(n+e,r)},list:function(){var n,r,s,o,u=0;arguments.length>0&&(typeof arguments[u]=="string"&&(n=arguments[u++]),typeof arguments[u]=="string"&&(r=arguments[u++]),typeof arguments[u]=="string"&&(s=arguments[u++]),typeof arguments[u]=="function"&&(o=arguments[u++])),s||(s=r||"any",r=n,n=e.name);var a="?vertex="+r+"&direction="+s;return t.get(i+n+a,o)}}}}),define("api/key",["require"],function(e){return function(e){function i(e,n,r,i,s){var o={},u;return r.expires&&(typeof r.expires=="object"?u=r.expires:u=new Date(Date.parse(r.expires,"yyyy-MM-dd HH:MM:SS")),o["x-voc-expires"]=u.toISOString()),r.extended&&(o["x-voc-extended"]=JSON.stringify(r.extended)),t.raw({method:e,headers:o},n,i,s)}function s(e){return e.replace(/^[.\/]*/,"")}var t=e.request,n="/_api/key/",r="/_api/keys/";return{get:function(){var r=e.name,i,o,u=0;return typeof arguments[u+1]=="string"&&(r=arguments[u++]),typeof arguments[u]=="string"&&(i=arguments[u++]),typeof arguments[u]=="function"&&(o=arguments[u++]),t.get(n+r+"/"+s(i),o)},create:function(){var t=e.name,r,o={},u={},a,f=0;return typeof arguments[f+1]=="string"&&(t=arguments[f++]),typeof arguments[f]=="string"&&(r=arguments[f++]),o=arguments[f++],u=arguments[f++],typeof arguments[f]=="function"&&(a=arguments[f++]),i("POST",n+t+"/"+s(r),o,u,a)},put:function(){var t=e.name,r,o={},u={},a,f=0;return typeof arguments[f+1]=="string"&&(t=arguments[f++]),typeof arguments[f]=="string"&&(r=arguments[f++]),o=arguments[f++],u=arguments[f++],typeof arguments[f]=="function"&&(a=arguments[f++]),i("PUT",n+t+"/"+s(r)+"?create=1",o,u,a)},list:function(){var n=e.name,i,o,u=0;return typeof arguments[u+1]=="string"&&(n=arguments[u++]),typeof arguments[u]=="string"&&(i=arguments[u++]),typeof arguments[u]=="function"&&(o=arguments[u++]),t.get(r+n+"/"+s(i),o)},"delete":function(){var r=e.name,i,o,u=0;return typeof arguments[u+1]=="string"&&(r=arguments[u++]),typeof arguments[u]=="string"&&(i=arguments[u++]),typeof arguments[u]=="function"&&(o=arguments[u++]),t.delete(n+r+"/"+s(i),o)}}}}),define("arango",["require","./utils","./action","./query","./action","./request","./api/collection","./api/document","./api/cursor","./api/simple","./api/index","./api/admin","./api/edge","./api/key"],function(e){function o(){function t(t,n){if(typeof t=="function"&&typeof n=="string"){var r=n.split(" ");r.forEach(function(n){e.event.on(n,t)})}}if(!(this instanceof o))return new o.apply(null,arguments);var e=this;this.event=new u(t),this.use.apply(this,arguments),Object.defineProperty(this,"server",{get:function(){return{protocol:this.protocol,hostname:this.hostname,port:this.port}}}),this.request={};var n=r.request(this);for(var i in n)this.request[i]=n[i];for(var s in r.api)this[s]=r.api[s](this);this.query=r.query(this),this.action=r.action(this)}function u(e){this.dispatcher=e,i.Emitter.call(this),this.on("register",e)}var t=typeof window=="object"&&window.hasOwnProperty("location"),n=t?window.location:!1,r={},i=e("./utils"),s=e("./action");return r.query=e("./query"),r.action=e("./action"),r.request=e("./request"),r.api={collection:e("./api/collection"),document:e("./api/document"),cursor:e("./api/cursor"),simple:e("./api/simple"),index:e("./api/index"),admin:e("./api/admin"),edge:e("./api/edge"),key:e("./api/key")},o.prototype.use=function(){for(var e=0,t;t=arguments[e];e++)if(t instanceof o)i.extend(this,t);else if(typeof t=="object")i.extend(!0,this,t);else if(typeof t=="string"){var r=i.parseUrl(t);r?(i.extend(this,r),r.path!==null&&(this.path=r.path,typeof this.path=="string"?this.name=this.path:typeof this.path=="object"&&(this.name=this.path.first))):this.name=t}else typeof t=="function"&&this.event.register("connect",t);return this.protocol=this.protocol||(n?n.protocol.split(":")[0]:"http"),this.hostname=this.hostname||(n?n.hostname:"127.0.0.1"),this.port=parseInt(this.port,10)||(n?n.port:8529),this.name=this.name||"",this},i.inherit(u,i.Emitter),u.prototype.register=function(){var e=0,t,n;typeof arguments[e]=="string"&&(n=arguments[e++]),typeof arguments[e]=="function"&&(t=arguments[e++]),t&&this.emit("register",t,n)},{Connection:o}})
/*Copyright (c) Kaerus 2012 (kaerus.com), Anders Elo <anders @ kaerus com>*/
define("utils",["require"],function(e){function t(){var e=!1,n={},r=0;typeof arguments[r]=="boolean"&&(e=arguments[r++]),typeof arguments[r+1]=="object"&&(n=arguments[r++]);for(var i;i=arguments[r];r++)n=Object.keys(i).reduce(function(n,r){return i.hasOwnProperty(r)&&(typeof i[r]=="object"?e&&(n[r]=t(!0,n[r],i[r])):i[r]&&(n[r]=i[r])),n},n);return n}function n(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}function r(e){if(!(this instanceof r))return new r;this._events={}}function i(e){var t=/^(?:([A-Za-z]+):)?(\/{0,3})(?:([^\x00-\x1F\x7F:]+)?:?([^\x00-\x1F\x7F:]*)@)?([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^\x00-\x1F\x7F]+))?$/,n=t.exec(e);if(!n)return!1;var r=/^([\w\-]+)?(?:#([\w\-]+))?(?:\:([\w\-]+))?(?:\?(.*))?$/,i=r.exec(n[7]);return n?{uriparts:n,protocol:n[1],username:n[3],password:n[4],hostname:n[5],port:n[6],path:i?{first:i[1],hash:i[2],base:i[3],query:i[4],string:n[7]}:n[7]}:!1}function s(e){return Object.prototype.toString.call(e)==="[object Array]"}return r.prototype.on=function(e,t){return e in this._events||(this._events[e]=[]),this._events[e].indexOf(t)<0&&this._events[e].push(t),this},r.prototype.off=function(e,t){if(!this._events[e])return this;var n=this._events[e].indexOf(t);return n>=0&&(this._events[e].splice(n,1),this._events[e].length===0&&delete this._events[e]),this},r.prototype.emit=function(e){if(!this._events[e])return!1;var t=Array.prototype.slice.call(arguments,1),n,r=[],i=!1;for(var s=0,o=this._events[e].length;s<o;s++){n=this._events[e][s];if(typeof n=="function"){if(n.apply(this,t)===!1){i=!0;break}}else{if(typeof n!="object")throw"No valid event handler found";typeof n.after=="function"&&r.push(n.after)}}return r.forEach(function(e){i||e.apply(this,t)===!1&&(i=!0)}),this},r.prototype.once=function(e,t){var n=this;return this.on(e,function r(){n.off(e,r),t.apply(this,arguments)}),this},r.prototype.after=function(e,t){return e in this._events||(this._events[e]=[]),this._events[e].indexOf({after:t})<0&&this._events[e].push({after:t}),this},{extend:t,inherit:n,Emitter:r,parseUrl:i,isArray:s}}),define("action",["require","./utils"],function(e){var t=e("./utils");return function(e){function r(){this.submit={}}var n=e.request;return r.prototype.define=function(r){function s(){var e=Array.prototype.splice.call(arguments);return r.data&&(e[0]&&typeof e[0]!="function"?t.isArray(e[0])?e[0].concat(r.data):typeof e[0]=="object"&&(e[0]=t.extend(!0,r.data,e[0])):e.unshift(r.data)),e.unshift(r.url.path?r.url.path.string?r.url.path.string:r.url.path:""),e.unshift(i),n.raw.apply(r.context,e).then(r.result,r.error)}if(typeof r!="object")throw new Error("Action object unspecified");if(!r.name)throw new Error("Action name missing");if(!(r.url=t.parseUrl(r.url)))throw new URIError("Action url invalid");if(r.data&&typeof r.data!="object")throw new Error("Invalid action data type");var i={};return i.method=r.method?r.method.toUpperCase():"GET",i.protocol=r.url.protocol?r.url.protocol:e.server.protocol,i.hostname=r.url.hostname?r.url.hostname:e.server.hostname,i.port=r.url.port?parseInt(r.url.port,10):e.server.port,r.options&&t.extend(!0,i,r.options),this.submit[r.name]=s,this},r.prototype.invoke=function(){var e=Array.prototype.slice.call(arguments),t=e.shift();return this.submit[t].apply(null,e)},new r}}),define("query",["require","./utils"],function(e){var t=e("./utils");return function(e){function n(){function r(n){var i=n||t.struct;return e.filter(function(e){return i[e]?!0:!1}).map(function(e){var t=e.toUpperCase(),n=i[e];switch(t){case"FROM":t="IN";break;case"INCLUDE":t="";break;default:}if(typeof n=="object"){var s=r(n);return e==="in"?t+" ( "+s+" )":t+" "+s}return t+" "+n}).join(" ")}var e=["for","in","filter","from","include","collect","into","sort","limit","return"],t=this;e.forEach(function(e){t[e]=function(){t.struct||(t.struct={});if(!arguments.length)return t.struct[e];var r=Array.prototype.slice.call(arguments);return typeof r[0]=="function"?t.struct[e]=function(e){var t=new n;return e.apply(t),t.struct}(r[0]):t.struct[e]=r.join(" "),t}}),t.toString=r}function r(){function i(n,i){var s,o=0,u=Array.prototype.slice.call(i);return r.string?s=t.extend({query:r.string},r.options):typeof u[o]=="string"?s=t.extend({query:u[o++]},r.options):typeof u[o]=="object"&&u[o].struct?s=t.extend({query:u[o++].struct.toString()},r.options):s=t.extend({query:u[o++].toString()},r.options),typeof u[o]=="object"&&t.extend(s,{bindVars:u[o++]}),e.cursor[n](s,u[o])}var r=this;n.call(this),r.string={},r.new=function(){return new n},Object.defineProperty(this,"string",{get:function(){return r.struct?r.toString():this._string},set:function(e){this._string=e,r.struct=null}}),r.options={},r.count=function(e){return r.options.count=e>0?!0:!1,r.options.batchSize=e>0?e:undefined,r},r.test=function(){return i("query",arguments)},r.explain=function(){return i("explain",arguments)},r.exec=function(){var t=function(n){var r=n.result;return r.hasMore?r.next=function(){return e.cursor.get(r.id).then(t)}:delete r.next,r};return i("create",arguments).then(t)}}return t.inherit(r,n),new r}}),define("ajax",["require","./utils"],function(e){function r(e,t){var n={NOXHR:[1e3,"Ajax is not supported"],REQUEST:[1001,"Request operation failed"],UNIMPLEMENTED:[1002,"no such feature"]};return{name:"Ajax",type:e,code:n[e][0],message:n[e][1]+(t?": "+t:"")}}function c(e,t){n.Emitter.call(this),this.data=[],this.data.size=0,this.on("response",t),this.after("end",function(){e.close()}),this.after("error",function(){e.close()})}function h(t,l){(function(){if(i==="nodejs"){var n=e(t.protocol||"http").request;h=function(e,t){return delete e.protocol,e.timeout&&(n.socket.setTimeout(e.timeout),delete e.timeout),n(e,t)}}})();if(!(this instanceof h))return new h(t,l);var p=this;p._send=[],p.xhr=new i,n.Emitter.call(this),t.timeout?(p._timeout=t.timeout,delete t.timeout):p._timeout=5e3,p.timeoutHandler=function(){p.xhr.abort()},p.response=new c(p,l),p.response.emit("response",p.response),p.xhr.onreadystatechange=function(){switch(p.xhr.readyState){case f:p.xhr.status?(p.response.statusCode=p.xhr.status,p.response.headers||(p.response.headers=p.parseHeaders()),p.xhr.status>399?(p.response.error=!0,p.response.message=p.xhr.statusText):p.response.writeChunk(p.xhr.responseText),p.response.emit("end")):p.response.emit("error",r("REQUEST","statuscode not set"));break;case a:p.response.headers=p.parseHeaders(),p.response.writeChunk(p.xhr.responseText);break;case u:p.emit("ready");break;case o:break;case s:}},p.on("open",p.startTimer),p.on("close",p.clearTimer),p.request(t,l)}var t=typeof window=="object",n=e("./utils"),i=t?function(){var e,t;if(typeof window.XMLHttpRequest!="undefined")return window.XMLHttpRequest;if(typeof window.ActiveXObject!="undefined"){e="ActiveXObject";var n=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];for(var i=0,s=n.length;i<s;i++)try{return window.ActiveXObject(n[i])}catch(o){}throw r("NOXHR","XHR ActiveXObject failed")}throw r("NOXHR","XHR support not found")}():"nodejs",s=0,o=1,u=2,a=3,f=4,l=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];return n.inherit(c,n.Emitter),c.prototype.write=function(e){this.data.push(e),this.data.size+=e.length,this.emit("data",this.data[this.data.length-1])},c.prototype.writeChunk=function(e){e.length>this.data.size&&this.write(e.slice(this.data.size))},n.inherit(h,n.Emitter),h.prototype.write=function(e){return this._send.push(e),this},h.prototype.end=function(e){e&&this._send.push(e),this.xhr.send(this._send.length>0?this._send.join(""):null)},h.prototype.close=function(){this.emit("close")},h.prototype.parseHeaders=function(){var e={},t,n,r,i=this.xhr.getAllResponseHeaders();return i.split("\n").forEach(function(i){r=i.indexOf(":"),t=i.slice(0,r).replace(/^[\s]+|[\s]+$/g,"").toLowerCase(),n=i.slice(r+1,i.length).replace(/^[\s]+|[\s]+$/g,""),t&&t.length&&(e[t]=n)}),e},h.prototype.request=function(e,n){var r=e.protocol==="file"&&t,i=r?"http://127.0.0.1:8529/"+e.path:e.protocol+"://"+e.hostname+":"+e.port+"/"+e.path;e.method=e.method?e.method:"GET",e.headers||(e.headers={}),e.headers["content-type"]||(e.headers["content-type"]="application/json"),this.xhr.open(e.method,i,!0),this.emit("open",e.method,i),Object.keys(e.headers).forEach(function(n){n=n.toLowerCase(),(!t||l.indexOf(n)<0)&&this.xhr.setRequestHeader(n,e.headers[n])},this)},h.prototype.startTimer=function(){this.timer=setTimeout(this.timeoutHandler,this._timeout)},h.prototype.clearTimer=function(){clearTimeout(this.timer)},h.prototype.resetTimer=function(){clearTimeout(this.timer),this.startTimer()},{request:h}}),function(e){if(typeof bootstrap=="function")bootstrap("promise",e);else if(typeof exports=="object")module.exports=e();else if(typeof define=="function")define("ext/q",e);else if(typeof ses!="undefined"){if(!ses.ok())return;ses.makeQ=e}else Q=e()}(function(){function g(e){return m(e)==="[object StopIteration]"||e instanceof y}function w(e,t){t.stack&&typeof e=="object"&&e!==null&&e.stack&&e.stack.indexOf(b)===-1&&(e.stack=E(e.stack)+"\n"+b+"\n"+E(t.stack))}function E(e){var t=e.split("\n"),n=[];for(var r=0;r<t.length;++r){var i=t[r];!x(i)&&!S(i)&&n.push(i)}return n.join("\n")}function S(e){return e.indexOf("(module.js:")!==-1||e.indexOf("(node.js:")!==-1}function x(n){var r=/at .+ \((.*):(\d+):\d+\)/.exec(n);if(!r)return!1;var i=r[1],s=r[2];return i===t&&s>=e&&s<=vt}function T(){if(Error.captureStackTrace){var e,n,r=Error.prepareStackTrace;return Error.prepareStackTrace=function(t,r){e=r[1].getFileName(),n=r[1].getLineNumber()},(new Error).stack,Error.prepareStackTrace=r,t=e,n}}function N(e,t,n){return function(){return typeof console!="undefined"&&typeof console.warn=="function"&&console.warn(t+" is deprecated, use "+n+" instead.",(new Error("")).stack),e.apply(e,arguments)}}function C(e){return R(e)}function k(){function u(r){if(!e)return;n=R(r),c(e,function(e,t){i(function(){n.promiseDispatch.apply(n,t)})},void 0),e=void 0,t=void 0}var e=[],t=[],n,s=d(k.prototype),o=d(A.prototype);return o.promiseDispatch=function(r,s,o){var u=l(arguments);e?(e.push(u),s==="when"&&o[1]&&t.push(o[1])):i(function(){n.promiseDispatch.apply(n,u)})},o.valueOf=function(){return e?o:n.valueOf()},Error.captureStackTrace&&(Error.captureStackTrace(o,k),o.stack=o.stack.substring(o.stack.indexOf("\n")+1)),r(o),s.promise=o,s.resolve=u,s.fulfill=function(e){u(q(e))},s.reject=function(e){u(I(e))},s.notify=function(n){e&&c(t,function(e,t){i(function(){t(n)})},void 0)},s}function L(e){var t=k();return Z(e,t.resolve,t.reject,t.notify).fail(t.reject),t.promise}function A(e,t,n,i){t===void 0&&(t=function(e){return I(new Error("Promise does not support operation: "+e))});var s=d(A.prototype);return s.promiseDispatch=function(n,r,i){var o;try{e[r]?o=e[r].apply(s,i):o=t.call(s,r,i)}catch(u){o=I(u)}n&&n(o)},n&&(s.valueOf=n),i&&(s.exception=i),r(s),s}function O(e){return M(e)?e.valueOf():e}function M(e){return e&&typeof e.promiseDispatch=="function"}function _(e){return D(e)||P(e)}function D(e){return!M(O(e))}function P(e){return e=O(e),M(e)&&"exception"in e}function F(){!j&&typeof window!="undefined"&&!window.Touch&&window.console&&console.log("Should be empty:",B),j=!0}function I(e){e=e||new Error;var t=A({when:function(t){if(t){var n=h(H,this);n!==-1&&(B.splice(n,1),H.splice(n,1))}return t?t(e):I(e)}},function(){return I(e)},function n(){return this},e);return F(),H.push(t),B.push(e),t}function q(e){return A({when:function(){return e},get:function(t){return e[t]},set:function(t,n){return e[t]=n,e},"delete":function(t){return delete e[t],e},post:function(t,n){return e[t].apply(e,n)},apply:function(t){return e.apply(void 0,t)},keys:function(){return v(e)}},void 0,function t(){return e})}function R(e){return M(e)?e:(e=O(e),e&&typeof e.then=="function"?U(e):q(e))}function U(e){var t=k();return e.then(t.resolve,t.reject,t.notify),t.promise}function z(e){return A({isDef:function(){}},function(n,r){return K(e,n,r)},function(){return O(e)})}function W(e,t,n,r){function u(e){try{return t?t(e):e}catch(n){return I(n)}}function a(e){if(n){w(e,l);try{return n(e)}catch(t){return I(t)}}return I(e)}function f(e){return r?r(e):e}var s=k(),o=!1,l=R(e);return i(function(){l.promiseDispatch(function(e){if(o)return;o=!0,s.resolve(u(e))},"when",[function(e){if(o)return;o=!0,s.resolve(a(e))}])}),l.promiseDispatch(void 0,"when",[void 0,function(e){var t,n=!1;try{t=f(e)}catch(r){n=!0;if(!C.onerror)throw r;C.onerror(r)}n||s.notify(t)}]),s.promise}function X(e,t,n){return W(e,function(e){return tt(e).then(function(e){return t.apply(void 0,e)},n)},n)}function V(e){return function(){function t(e,t){var s;try{s=n[e](t)}catch(o){return g(o)?o.value:I(o)}return W(s,r,i)}var n=e.apply(this,arguments),r=t.bind(t,"send"),i=t.bind(t,"throw");return r()}}function $(e){throw new y(e)}function J(e){return function(){return X([this,tt(arguments)],function(t,n){return e.apply(t,n)})}}function K(e,t,n){var r=k();return i(function(){R(e).promiseDispatch(r.resolve,t,n)}),r.promise}function Q(e){return function(t){var n=l(arguments,1);return K(t,e,n)}}function Z(e){var t=l(arguments,1);return Y(e,t)}function et(e){var t=l(arguments,1);return function(){var r=t.concat(l(arguments));return Y(e,r)}}function tt(e){return W(e,function(e){var t=e.length;if(t===0)return R(e);var n=k();return c(e,function(r,i,s){D(i)?(e[s]=O(i),--t===0&&n.resolve(e)):W(i,function(r){e[s]=r,--t===0&&n.resolve(e)}).fail(n.reject)},void 0),n.promise})}function nt(e){return W(e,function(e){return W(tt(p(e,function(e){return W(e,n,n)})),function(){return p(e,R)})})}function rt(e,t){return W(e,void 0,t)}function it(e,t){return W(e,void 0,void 0,t)}function st(e,t){return W(e,function(e){return W(t(),function(){return e})},function(e){return W(t(),function(){return I(e)})})}function ot(e,t,n,r){var s=function(t){i(function(){w(t,e);if(!C.onerror)throw t;C.onerror(t)})},o=t||n||r?W(e,t,n,r):e;typeof process=="object"&&process&&process.domain&&(s=process.domain.bind(s)),rt(o,s)}function ut(e,t){var n=k(),r=setTimeout(function(){n.reject(new Error("Timed out after "+t+" ms"))},t);return W(e,function(e){clearTimeout(r),n.resolve(e)},function(e){clearTimeout(r),n.reject(e)}),n.promise}function at(e,t){t===void 0&&(t=e,e=void 0);var n=k();return setTimeout(function(){n.resolve(e)},t),n.promise}function ft(e,t){var n=l(t),r=k();return n.push(r.makeNodeResolver()),Y(e,n).fail(r.reject),r.promise}function lt(e){var t=l(arguments,1),n=k();return t.push(n.makeNodeResolver()),Y(e,t).fail(n.reject),n.promise}function ct(e){var t=l(arguments,1);return function(){var n=t.concat(l(arguments)),r=k();return n.push(r.makeNodeResolver()),Y(e,n).fail(r.reject),r.promise}}function ht(e,t,n){var r=l(n),i=k();return r.push(i.makeNodeResolver()),G(e,t,r).fail(i.reject),i.promise}function pt(e,t){var n=l(arguments,2),r=k();return n.push(r.makeNodeResolver()),G(e,t,n).fail(r.reject),r.promise}function dt(e,t){if(!t)return e;e.then(function(e){i(function(){t(null,e)})},function(e){i(function(){t(e)})})}var e=T(),t,n=function(){},r=Object.freeze||n;typeof cajaVM!="undefined"&&(r=cajaVM.def);var i;if(typeof process!="undefined")i=process.nextTick;else if(typeof setImmediate=="function")i=setImmediate;else if(typeof MessageChannel!="undefined"){var s=new MessageChannel,o={},u=o;s.port1.onmessage=function(){o=o.next;var e=o.task;delete o.task,e()},i=function(e){u=u.next={task:e},s.port2.postMessage(0)}}else i=function(e){setTimeout(e,0)};var a;if(Function.prototype.bind){var f=Function.prototype.bind;a=f.bind(f.call)}else a=function(e){return function(){return e.call.apply(e,arguments)}};var l=a(Array.prototype.slice),c=a(Array.prototype.reduce||function(e,t){var n=0,r=this.length;if(arguments.length===1)do{if(n in this){t=this[n++];break}if(++n>=r)throw new TypeError}while(1);for(;n<r;n++)n in this&&(t=e(t,this[n],n));return t}),h=a(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),p=a(Array.prototype.map||function(e,t){var n=this,r=[];return c(n,function(i,s,o){r.push(e.call(t,s,o,n))},void 0),r}),d=Object.create||function(e){function t(){}return t.prototype=e,new t},v=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t},m=Object.prototype.toString,y;typeof ReturnValue!="undefined"?y=ReturnValue:y=function(e){this.value=e};var b="From previous event:";C.nextTick=i,C.defer=k,k.prototype.makeNodeResolver=function(){var e=this;return function(t,n){t?e.reject(t):arguments.length>2?e.resolve(l(arguments,1)):e.resolve(n)}},C.promise=L,C.makePromise=A,A.prototype.then=function(e,t,n){return W(this,e,t,n)},A.prototype.thenResolve=function(e){return W(this,function(){return e})},c(["isResolved","isFulfilled","isRejected","dispatch","when","spread","get","put","set","del","delete","post","send","invoke","keys","fapply","fcall","fbind","all","allResolved","timeout","delay","catch","finally","fail","fin","progress","done","nfcall","nfapply","nfbind","ncall","napply","nbind","npost","nsend","ninvoke","nend","nodeify"],function(e,t){A.prototype[t]=function(){return C[t].apply(C,[this].concat(l(arguments)))}},void 0),A.prototype.toSource=function(){return this.toString()},A.prototype.toString=function(){return"[object Promise]"},r(A.prototype),C.nearer=O,C.isPromise=M,C.isResolved=_,C.isFulfilled=D,C.isRejected=P;var H=[],B=[],j;C.reject=I,C.fulfill=q,C.resolve=R,C.master=z,C.when=W,C.spread=X,C.async=V,C["return"]=$,C.promised=J,C.dispatch=K,C.dispatcher=Q,C.get=Q("get"),C.put=C.set=Q("set"),C["delete"]=C.del=Q("delete");var G=C.post=Q("post");C.send=function(e,t){var n=l(arguments,2);return G(e,t,n)},C.invoke=N(C.send,"invoke","send");var Y=C.fapply=Q("apply");C["try"]=Z,C.fcall=Z,C.fbind=et,C.keys=Q("keys"),C.all=tt,C.allResolved=nt,C["catch"]=C.fail=rt,C.progress=it,C["finally"]=C.fin=st,C.done=ot,C.timeout=ut,C.delay=at,C.nfapply=ft,C.nfcall=lt,C.nfbind=ct,C.npost=ht,C.nsend=pt,C.ninvoke=N(pt,"ninvoke","nsend"),C.nodeify=dt;var vt=T();return C}),define("request",["require","./utils","./ajax","./ext/q"],function(e){function i(e,t,i){var s=r.defer(),o=n.request(e,function(e){var t={},n;typeof e.data!="object"&&(e.data=[],e.on("data",function(t){e.data.push(t)})),e.on("end",function(){if(e.data.length>0)try{t=JSON.parse(e.data.join(""))}catch(r){t=e.data.join("")}t.error?n={error:!0,code:t.code,message:t.errorMessage}:e.error&&(n={error:!0,code:e.statusCode,message:t.message}),n?s.reject(n):(delete (t,"error","code"),s.resolve({result:t,headers:e.headers,error:!1,code:e.statusCode}))})}).on("error",function(e){s.reject(e)});return t&&o.write(t),o.end(),i&&s.promise.then(function(e){i(null,e.result,e.headers)},function(e){i(e.code,e.message)}),s.promise}var t=e("./utils"),n=e("./ajax"),r=e("./ext/q");return function(e){function n(n,r,s,o){try{s=s&&!s.length?new Buffer(JSON.stringify(s)):s}catch(u){s=JSON.stringify(s)}return n=t.extend(!0,{path:r,headers:{"content-type":"application/json",connection:"keep-alive","content-length":s?s.length:0}},e.server,n),e.auth&&(n.headers.authorization=e.auth),i(n,s,o)}return{post:function(e,t,r){return n({method:"POST"},e,t,r)},get:function(e,t){return n({method:"GET"},e,null,t)},put:function(e,t,r){return n({method:"PUT"},e,t,r)},"delete":function(e,t){return n({method:"DELETE"},e,null,t)},patch:function(e,t,r){return n({method:"PATCH"},e,t,r)},head:function(e,t){return n({method:"HEAD"},e,null,t)},raw:function(e,t,r,i){return n(e,t,r,i)}}}}),define("api/collection",["require"],function(e){return function(e){var t=e.request,n="/_api/collection/";return{create:function(){var r=e.name,i={},s,o=0;return typeof arguments[o]=="string"&&(r=arguments[o++]),typeof arguments[o]=="object"&&(i=arguments[o++]),typeof arguments[o]=="function"&&(s=arguments[o++]),i.name||(i.name=r),t.post(n,i,s)},get:function(e,r){return t.get(n+e,r)},"delete":function(e,r){return t.delete(n+e,r)},truncate:function(e,r){return t.put(n+e+"/truncate",null,r)},count:function(e,r){return t.get(n+e+"/count",r)},figures:function(e,r){return t.get(n+e+"/figures",r)},list:function(e){return t.get(n,e)},load:function(e,r){return t.put(n+e+"/load",null,r)},unload:function(e,r){return t.put(n+e+"/unload",null,r)},rename:function(e,r,i){return typeof r=="string"&&(r={name:r}),t.put(n+e+"/rename",r,i)},getProperties:function(e,r){return t.get(n+e+"/properties",r)},setProperties:function(e,r,i){return t.put(n+e+"/properties",r,i)}}}}),define("api/document",["require"],function(e){return function(e){function i(e,n,r,i){var s={};return s[e]=JSON.stringify(r),t.raw({headers:s},n,null,i)}function s(e,n,r,i,s){var o={};return o[e]=JSON.stringify(r),t.raw({method:"PUT",headers:o},n,i,s)}var t=e.request,n="/_api/document/",r="/_api/document?collection=";return{create:function(){var n=e.name,i={},s="",o,u=0;return typeof arguments[u]=="boolean"&&arguments[u]===!0&&(s="&createCollection=true",u++),typeof arguments[u]=="string"&&(n=arguments[u++]),typeof arguments[u]=="object"&&(i=arguments[u++]),typeof arguments[u]=="function"&&(o=arguments[u++]),t.post(r+n+s,i,o)},get:function(e,r){return t.get(n+e,r)},getIfNoneMatch:function(e,t,r){return i("If-None-Match",n+e,t,r)},getIfMatch:function(e,t,r){return i("If-Match",n+e,t,r)},put:function(e,r,i){return t.put(n+e,r,i)},putIfNoneMatch:function(e,t,r,i){return s("if-none-match",n+e,t,r,i)},putIfMatch:function(e,t,r,i){return s("if-match",n+e,t,r,i)},head:function(e,r){return t.head(n+e,r)},patch:function(e,r,i){return t.patch(n+e,r,i)},"delete":function(e,r){return t.delete(n+e,r)},list:function(){var n=e.name,i,s=0;return typeof arguments[s]=="string"&&(n=arguments[s++]),typeof arguments[s]=="function"&&(i=arguments[s++]),t.get(r+n,i)},"import":function(){var t=e.name,n={},r="",i,s=0;typeof arguments[s]=="boolean"&&(r="&createCollection=true",s++),typeof arguments[s]=="string"&&(t=arguments[s++]),typeof arguments[s]=="object"&&(n=arguments[s++]),typeof arguments[s]=="function"&&(i=arguments[s++])}}}}),define("api/cursor",["require"],function(e){return function(e){var t=e.request,n="/_api/cursor/";return{get:function(e,r){return t.put(n+e,{},r)},create:function(e,r){return t.post(n,e,r)},query:function(e,n){return t.post("/_api/query",e,n)},explain:function(e,n){return t.post("/_api/explain",e,n)},"delete":function(e,r){return t.delete(n+e,r)}}}}),define("api/simple",["require"],function(e){return function(e){function s(e,t){return typeof t=="object"&&Object.keys(t).forEach(function(n){switch(n){case"from":e.left=t[n],e.closed=!0;break;case"to":e.right=t[n],e.closed=!0;break;default:e[n]=t[n]}r&&!e.skip&&(e.skip=r),i&&!e.limit&&(e.limit=i)}),e}var t=e.request,n="/_api/simple/",r,i;return{list:function(){var r={collection:e.name},i=0,o,u;return typeof arguments[i]=="string"&&(r.collection=arguments[i++]),typeof arguments[i]=="object"&&(o=arguments[i++]),typeof arguments[i]=="function"&&(u=arguments[i++]),t.put(n+"all",s(r,o),u)},example:function(){var r={collection:e.name},i=0,o,u;return typeof arguments[i]=="string"&&(r.collection=arguments[i++]),typeof arguments[i]=="object"&&typeof arguments[i+1]=="object"&&(o=arguments[i++]),typeof arguments[i]=="object"&&(r.example=arguments[i++]),typeof arguments[i]=="function"&&(u=arguments[i++]),t.put(n+"by-example",s(r,o),u)},first:function(){var r={collection:e.name},i=0,s,o;return typeof arguments[i]=="string"&&(r.collection=arguments[i++]),typeof arguments[i]=="object"&&(r.example=arguments[i++]),typeof arguments[i]=="function"&&(o=arguments[i++]),t.put(n+"first-example",r,o)},range:function(){var r={collection:e.name},i=0,o,u;return typeof arguments[i]=="string"&&(r.collection=arguments[i++]),typeof arguments[i]=="object"&&(o=arguments[i++]),typeof arguments[i]=="function"&&(u=arguments[i++]),t.put(n+"range",s(r,o),u)},near:function(){var r={collection:e.name},i=0,o,u;return typeof arguments[i]=="string"&&(r.collection=arguments[i++]),typeof arguments[i]=="object"&&(o=arguments[i++]),typeof arguments[i]=="function"&&(u=arguments[i++]),t.put(n+"near",s(r,o),u)},within:function(){var r={collection:e.name},i=0,o,u;return typeof arguments[i]=="string"&&(r.collection=arguments[i++]),typeof arguments[i]=="object"&&(o=arguments[i++]),typeof arguments[i]=="function"&&(u=arguments[i++]),t.put(n+"within",s(r,o),u)},skip:function(e){r=e},limit:function(e){i=e}}}}),define("api/index",["require"],function(e){return function(e){var t=e.request,n="/_api/index/",r="/_api/index?collection=";return{get:function(e,r){return t.get(n+e,r)},create:function(){var n=e.name,i={},s,o=0;return typeof arguments[o]=="string"&&(n=arguments[o++]),typeof arguments[o]=="object"&&(i=arguments[o++]),typeof arguments[o]=="function"&&(s=arguments[o++]),t.post(r+n,i,s)},"delete":function(e,r){return t.delete(n+e,r)},list:function(){var n=e.name,i,s=0;return arguments.length>0&&(typeof arguments[s]=="string"&&(n=arguments[s++]),typeof arguments[s]=="function"&&(i=arguments[s++])),t.get(r+n,i)}}}}),define("api/admin",["require"],function(e){return function(e){var t=e.request,n="/_admin/";return{status:function(e){return t.get(n+"status",e)},log:function(){var e="",r,i=0;return typeof arguments[i]=="string"&&(severity="?level="+arguments[i++]),typeof arguments[i]=="object"&&Object.keys(arguments[i++]).forEach(function(e){severity+=severity.length?"&":"?",severity+=e+"="+arguments[i][e]}),typeof arguments[i]=="function"&&(r=arguments[i++]),t.get(n+"log"+severity,r)},getConfig:function(e){return t.get(n+"config/configuration",e)},describeConfig:function(e){return t.get(n+"config/description",e)},listUsers:function(e){return t.get(n+"user-manager/users",e)},getUser:function(e,r){return t.get(n+"user-manager/user/"+e,r)},routes:function(e){return t.get(n+"routing/routes",e)},routesReload:function(e){return t.get(n+"routing/reload",e)}}}}),define("api/edge",["require"],function(e){return function(e){function s(e,n,r,i){var s={};return s[e]=JSON.stringify(r),t.raw({headers:s},n,null,i)}function o(e,n,r,i,s){var o={};return o[e]=JSON.stringify(r),t.raw({method:"PUT",headers:o},n,i,s)}var t=e.request,n="/_api/edge/",r="/_api/edge?collection=",i="/_api/edges/";return{get:function(e,r){return t.get(n+e,r)},getIfNoneMatch:function(e,t,r){return s("If-None-Match",n+e,t,r)},getIfMatch:function(e,t,r){return s("If-Match",n+e,t,r)},create:function(){var n,i,s,o={},u,a=0;return typeof arguments[a]=="string"&&(n=arguments[a++]),typeof arguments[a]=="string"&&(i=arguments[a++]),typeof arguments[a]=="string"&&(s=arguments[a++]),typeof arguments[a]=="object"&&(o=arguments[a++]),typeof arguments[a]=="function"&&(u=arguments[a++]),s||(s=i,i=n,n=e.name),t.post(r+n+"&from="+i+"&to="+s,o,u)},put:function(e,r,i){return t.put(n+e,r,i)},putIfNoneMatch:function(e,t,r,i){return o("if-none-match",n+e,t,r,i)},putIfMatch:function(e,t,r,i){return o("if-match",n+e,t,r,i)},head:function(e,r){return t.head(n+e,r)},patch:function(e,r,i){return t.patch(n+e,r,i)},"delete":function(e,r){return t.delete(n+e,r)},list:function(){var n,r,s,o,u=0;arguments.length>0&&(typeof arguments[u]=="string"&&(n=arguments[u++]),typeof arguments[u]=="string"&&(r=arguments[u++]),typeof arguments[u]=="string"&&(s=arguments[u++]),typeof arguments[u]=="function"&&(o=arguments[u++])),s||(s=r||"any",r=n,n=e.name);var a="?vertex="+r+"&direction="+s;return t.get(i+n+a,o)}}}}),define("api/key",["require"],function(e){return function(e){function i(e,n,r,i,s){var o={},u;return r.expires&&(typeof r.expires=="object"?u=r.expires:u=new Date(Date.parse(r.expires,"yyyy-MM-dd HH:MM:SS")),o["x-voc-expires"]=u.toISOString()),r.extended&&(o["x-voc-extended"]=JSON.stringify(r.extended)),t.raw({method:e,headers:o},n,i,s)}function s(e){return e.replace(/^[.\/]*/,"")}var t=e.request,n="/_api/key/",r="/_api/keys/";return{get:function(){var r=e.name,i,o,u=0;return typeof arguments[u+1]=="string"&&(r=arguments[u++]),typeof arguments[u]=="string"&&(i=arguments[u++]),typeof arguments[u]=="function"&&(o=arguments[u++]),t.get(n+r+"/"+s(i),o)},create:function(){var t=e.name,r,o={},u={},a,f=0;return typeof arguments[f+1]=="string"&&(t=arguments[f++]),typeof arguments[f]=="string"&&(r=arguments[f++]),o=arguments[f++],u=arguments[f++],typeof arguments[f]=="function"&&(a=arguments[f++]),i("POST",n+t+"/"+s(r),o,u,a)},put:function(){var t=e.name,r,o={},u={},a,f=0;return typeof arguments[f+1]=="string"&&(t=arguments[f++]),typeof arguments[f]=="string"&&(r=arguments[f++]),o=arguments[f++],u=arguments[f++],typeof arguments[f]=="function"&&(a=arguments[f++]),i("PUT",n+t+"/"+s(r)+"?create=1",o,u,a)},list:function(){var n=e.name,i,o,u=0;return typeof arguments[u+1]=="string"&&(n=arguments[u++]),typeof arguments[u]=="string"&&(i=arguments[u++]),typeof arguments[u]=="function"&&(o=arguments[u++]),t.get(r+n+"/"+s(i),o)},"delete":function(){var r=e.name,i,o,u=0;return typeof arguments[u+1]=="string"&&(r=arguments[u++]),typeof arguments[u]=="string"&&(i=arguments[u++]),typeof arguments[u]=="function"&&(o=arguments[u++]),t.delete(n+r+"/"+s(i),o)}}}}),define("arango",["require","./utils","./action","./query","./action","./request","./api/collection","./api/document","./api/cursor","./api/simple","./api/index","./api/admin","./api/edge","./api/key"],function(e){function o(){function t(t,n){if(typeof t=="function"&&typeof n=="string"){var r=n.split(" ");r.forEach(function(n){e.event.on(n,t)})}}if(!(this instanceof o))return new o.apply(null,arguments);var e=this;this.event=new u(t),this.use.apply(this,arguments),Object.defineProperty(this,"server",{get:function(){return{protocol:this.protocol,hostname:this.hostname,port:this.port}}}),this.request={};var n=r.request(this);for(var i in n)this.request[i]=n[i];for(var s in r.api)this[s]=r.api[s](this);this.query=r.query(this),this.action=r.action(this)}function u(e){this.dispatcher=e,i.Emitter.call(this),this.on("register",e)}var t=typeof window=="object"&&window.hasOwnProperty("location"),n=t?window.location:!1,r={},i=e("./utils"),s=e("./action");return r.query=e("./query"),r.action=e("./action"),r.request=e("./request"),r.api={collection:e("./api/collection"),document:e("./api/document"),cursor:e("./api/cursor"),simple:e("./api/simple"),index:e("./api/index"),admin:e("./api/admin"),edge:e("./api/edge"),key:e("./api/key")},o.prototype.use=function(){for(var e=0,t;t=arguments[e];e++)if(t instanceof o)i.extend(this,t);else if(typeof t=="object")i.extend(!0,this,t);else if(typeof t=="string"){var r=i.parseUrl(t);r?(i.extend(this,r),r.path!==null&&(this.path=r.path,typeof this.path=="string"?this.name=this.path:typeof this.path=="object"&&(this.name=this.path.first))):this.name=t}else typeof t=="function"&&this.event.register("connect",t);return this.protocol=this.protocol||(n?n.protocol.split(":")[0]:"http"),this.hostname=this.hostname||(n?n.hostname:"127.0.0.1"),this.port=parseInt(this.port,10)||(n?n.port:8529),this.name=this.name||"",this.username&&(this.auth="Basic "+(new Buffer(this.username+":"+this.password)).toString("base64")),this},i.inherit(u,i.Emitter),u.prototype.register=function(){var e=0,t,n;typeof arguments[e]=="string"&&(n=arguments[e++]),typeof arguments[e]=="function"&&(t=arguments[e++]),t&&this.emit("register",t,n)},{Connection:o}});